<!doctype html>
<html class="hide">
	<head>
        <!-- BEGIN pre-common head -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" /> 

<meta content="WorldWide - Zara Home" name="description">
<title>WorldWide - Zara Home</title>
<link rel="canonical" href="http://www.zarahome.com/" />
<link rel="alternate" hreflang="x-default" href="http://www.zarahome.com/" />
<link rel="alternate" hreflang="en-DZ" href="http://www.zarahome.com/dz/" />
<link rel="alternate" hreflang="es-AD" href="http://www.zarahome.com/ad/" />
<link rel="alternate" hreflang="fr-AD" href="http://www.zarahome.com/ad/fr/" />
<link rel="alternate" hreflang="en-AD" href="http://www.zarahome.com/ad/en/" />
<link rel="alternate" hreflang="en-AU" href="http://www.zarahome.com/au/" />
<link rel="alternate" hreflang="en-BH" href="http://www.zarahome.com/bh/" />
<link rel="alternate" hreflang="fr-BE" href="http://www.zarahome.com/be/" />
<link rel="alternate" hreflang="en-BE" href="http://www.zarahome.com/be/en/" />
<link rel="alternate" hreflang="nl-BE" href="http://www.zarahome.com/be/nl/" />
<link rel="alternate" hreflang="pt-BR" href="http://www.zarahome.com/br/" />
<link rel="alternate" hreflang="en-BR" href="http://www.zarahome.com/br/en/" />
<link rel="alternate" hreflang="en-CA" href="http://www.zarahome.com/ca/" />
<link rel="alternate" hreflang="fr-CA" href="http://www.zarahome.com/ca/fr/" />
<link rel="alternate" hreflang="en-CL" href="http://www.zarahome.com/cl/" />
<link rel="alternate" hreflang="es-CL" href="http://www.zarahome.com/cl/es/" />
<link rel="alternate" hreflang="es-CO" href="http://www.zarahome.com/co/" />
<link rel="alternate" hreflang="en-CO" href="http://www.zarahome.com/co/en/" />
<link rel="alternate" hreflang="es-CR" href="http://www.zarahome.com/cr/" />
<link rel="alternate" hreflang="en-CR" href="http://www.zarahome.com/cr/en/" />
<link rel="alternate" hreflang="da-DK" href="http://www.zarahome.com/dk/" />
<link rel="alternate" hreflang="en-DK" href="http://www.zarahome.com/dk/en/" />
<link rel="alternate" hreflang="de-DE" href="http://www.zarahome.com/de/" />
<link rel="alternate" hreflang="en-DE" href="http://www.zarahome.com/de/en/" />
<link rel="alternate" hreflang="es-DO" href="http://www.zarahome.com/do/" />
<link rel="alternate" hreflang="en-DO" href="http://www.zarahome.com/do/en/" />
<link rel="alternate" hreflang="en-EG" href="http://www.zarahome.com/eg/" />
<link rel="alternate" hreflang="es-ES" href="http://www.zarahome.com/es/" />
<link rel="alternate" hreflang="ca-ES" href="http://www.zarahome.com/es/ca/" />
<link rel="alternate" hreflang="gl-ES" href="http://www.zarahome.com/es/gl/" />
<link rel="alternate" hreflang="eu-ES" href="http://www.zarahome.com/es/eu/" />
<link rel="alternate" hreflang="en-ES" href="http://www.zarahome.com/es/en/" />
<link rel="alternate" hreflang="es-IC" href="http://www.zarahome.com/ic/" />
<link rel="alternate" hreflang="en-IC" href="http://www.zarahome.com/ic/en/" />
<link rel="alternate" hreflang="et-EE" href="http://www.zarahome.com/ee/" />
<link rel="alternate" hreflang="en-EE" href="http://www.zarahome.com/ee/en/" />
<link rel="alternate" hreflang="fr-FR" href="http://www.zarahome.com/fr/" />
<link rel="alternate" hreflang="en-FR" href="http://www.zarahome.com/fr/en/" />
<link rel="alternate" hreflang="es-GT" href="http://www.zarahome.com/gt/" />
<link rel="alternate" hreflang="en-GT" href="http://www.zarahome.com/gt/en/" />
<link rel="alternate" hreflang="es-HN" href="http://www.zarahome.com/hn/" />
<link rel="alternate" hreflang="en-HN" href="http://www.zarahome.com/hn/en/" />
<link rel="alternate" hreflang="hr-HR" href="http://www.zarahome.com/hr/" />
<link rel="alternate" hreflang="en-HR" href="http://www.zarahome.com/hr/en/" />
<link rel="alternate" hreflang="en-HU" href="http://www.zarahome.com/hu/" />
<link rel="alternate" hreflang="en-ID" href="http://www.zarahome.com/id/" />
<link rel="alternate" hreflang="en-IE" href="http://www.zarahome.com/ie/" />
<link rel="alternate" hreflang="it-IT" href="http://www.zarahome.com/it/" />
<link rel="alternate" hreflang="en-IT" href="http://www.zarahome.com/it/en/" />
<link rel="alternate" hreflang="en-JO" href="http://www.zarahome.com/jo/" />
<link rel="alternate" hreflang="en-KW" href="http://www.zarahome.com/kw/" />
<link rel="alternate" hreflang="lv-LV" href="http://www.zarahome.com/lv/" />
<link rel="alternate" hreflang="en-LV" href="http://www.zarahome.com/lv/en/" />
<link rel="alternate" hreflang="en-LB" href="http://www.zarahome.com/lb/" />
<link rel="alternate" hreflang="lt-LT" href="http://www.zarahome.com/lt/" />
<link rel="alternate" hreflang="en-LT" href="http://www.zarahome.com/lt/en/" />
<link rel="alternate" hreflang="en-LU" href="http://www.zarahome.com/lu/" />
<link rel="alternate" hreflang="fr-LU" href="http://www.zarahome.com/lu/fr/" />
<link rel="alternate" hreflang="pt-MO" href="http://www.zarahome.com/mo/" />
<link rel="alternate" hreflang="en-MO" href="http://www.zarahome.com/mo/en/" />
<link rel="alternate" hreflang="en-MT" href="http://www.zarahome.com/mt/" />
<link rel="alternate" hreflang="fr-MA" href="http://www.zarahome.com/ma/" />
<link rel="alternate" hreflang="en-MA" href="http://www.zarahome.com/ma/en/" />
<link rel="alternate" hreflang="fr-MC" href="http://www.zarahome.com/mc/" />
<link rel="alternate" hreflang="en-MC" href="http://www.zarahome.com/mc/en/" />
<link rel="alternate" hreflang="es-MX" href="http://www.zarahome.com/mx/" />
<link rel="alternate" hreflang="en-MX" href="http://www.zarahome.com/mx/en/" />
<link rel="alternate" hreflang="nl-NL" href="http://www.zarahome.com/nl/" />
<link rel="alternate" hreflang="en-NL" href="http://www.zarahome.com/nl/en/" />
<link rel="alternate" hreflang="en-NO" href="http://www.zarahome.com/no/" />
<link rel="alternate" hreflang="en-OM" href="http://www.zarahome.com/om/" />
<link rel="alternate" hreflang="es-PA" href="http://www.zarahome.com/pa/" />
<link rel="alternate" hreflang="en-PA" href="http://www.zarahome.com/pa/en/" />
<link rel="alternate" hreflang="es-PY" href="http://www.zarahome.com/py/" />
<link rel="alternate" hreflang="en-PY" href="http://www.zarahome.com/py/en/" />
<link rel="alternate" hreflang="es-PE" href="http://www.zarahome.com/pe/" />
<link rel="alternate" hreflang="en-PE" href="http://www.zarahome.com/pe/en/" />
<link rel="alternate" hreflang="pl-PL" href="http://www.zarahome.com/pl/" />
<link rel="alternate" hreflang="en-PL" href="http://www.zarahome.com/pl/en/" />
<link rel="alternate" hreflang="pt-PT" href="http://www.zarahome.com/pt/" />
<link rel="alternate" hreflang="en-PT" href="http://www.zarahome.com/pt/en/" />
<link rel="alternate" hreflang="en-QA" href="http://www.zarahome.com/qa/" />
<link rel="alternate" hreflang="ro-RO" href="http://www.zarahome.com/ro/" />
<link rel="alternate" hreflang="en-RO" href="http://www.zarahome.com/ro/en/" />
<link rel="alternate" hreflang="en-KR" href="http://www.zarahome.com/kr/" />
<link rel="alternate" hreflang="en-SA" href="http://www.zarahome.com/sa/" />
<link rel="alternate" hreflang="de-CH" href="http://www.zarahome.com/ch/" />
<link rel="alternate" hreflang="it-CH" href="http://www.zarahome.com/ch/it/" />
<link rel="alternate" hreflang="fr-CH" href="http://www.zarahome.com/ch/fr/" />
<link rel="alternate" hreflang="en-CH" href="http://www.zarahome.com/ch/en/" />
<link rel="alternate" hreflang="en-RS" href="http://www.zarahome.com/rs/" />
<link rel="alternate" hreflang="en-SI" href="http://www.zarahome.com/si/" />
<link rel="alternate" hreflang="sk-SK" href="http://www.zarahome.com/sk/" />
<link rel="alternate" hreflang="en-SK" href="http://www.zarahome.com/sk/en/" />
<link rel="alternate" hreflang="en-ZA" href="http://www.zarahome.com/za/" />
<link rel="alternate" hreflang="en-FI" href="http://www.zarahome.com/fi/" />
<link rel="alternate" hreflang="en-SE" href="http://www.zarahome.com/se/" />
<link rel="alternate" hreflang="en-TH" href="http://www.zarahome.com/th/" />
<link rel="alternate" hreflang="en-TR" href="http://www.zarahome.com/tr/" />
<link rel="alternate" hreflang="en-TK" href="http://www.zarahome.com/tk/" />
<link rel="alternate" hreflang="en-XE" href="http://www.zarahome.com/xe/" />
<link rel="alternate" hreflang="en-GB" href="http://www.zarahome.com/gb/" />
<link rel="alternate" hreflang="en-US" href="http://www.zarahome.com/us/" />
<link rel="alternate" hreflang="es-US" href="http://www.zarahome.com/us/es/" />
<link rel="alternate" hreflang="es-UY" href="http://www.zarahome.com/uy/" />
<link rel="alternate" hreflang="en-UY" href="http://www.zarahome.com/uy/en/" />
<link rel="alternate" hreflang="de-AT" href="http://www.zarahome.com/at/" />
<link rel="alternate" hreflang="en-AT" href="http://www.zarahome.com/at/en/" />
<link rel="alternate" hreflang="cs-CZ" href="http://www.zarahome.com/cz/" />
<link rel="alternate" hreflang="en-CZ" href="http://www.zarahome.com/cz/en/" />
<link rel="alternate" hreflang="el-GR" href="http://www.zarahome.com/gr/" />
<link rel="alternate" hreflang="en-GR" href="http://www.zarahome.com/gr/en/" />
<link rel="alternate" hreflang="en-CY" href="http://www.zarahome.com/cy/" />
<link rel="alternate" hreflang="el-CY" href="http://www.zarahome.com/cy/el/" />
<link rel="alternate" hreflang="bg-BG" href="http://www.zarahome.com/bg/" />
<link rel="alternate" hreflang="en-BG" href="http://www.zarahome.com/bg/en/" />
<link rel="alternate" hreflang="ru-RU" href="http://www.zarahome.com/ru/" />
<link rel="alternate" hreflang="en-RU" href="http://www.zarahome.com/ru/en/" />
<link rel="alternate" hreflang="en-KZ" href="http://www.zarahome.com/kz/" />
<link rel="alternate" hreflang="en-CN" href="http://www.zarahome.com/cn/" />
<link rel="alternate" hreflang="en-TW" href="http://www.zarahome.com/tw/" />
<link rel="alternate" hreflang="ja-JP" href="http://www.zarahome.com/jp/" />
<link rel="alternate" hreflang="en-JP" href="http://www.zarahome.com/jp/en/" />
<link rel="alternate" hreflang="en-HK" href="http://www.zarahome.com/hk/" />

<!-- BEGIN SPOT=ZH3_ESpot_HeadBegin -->
<meta name="google-site-verification" content="JHOUm5iqm8hzNqConkDY2PEQAz_BYabsw31YV_2jivk" />

<!-- END SPOT=ZH3_ESpot_HeadBegin -->

<!-- BEGIN SPOT=ZH3_ESpot_WorldWidePageHead -->
<meta name="google-site-verification" content="SFEkj7Si0UC3qlnvVyhhTqfzJw37pEeS0IYnNNQfmZk" />
<!-- END SPOT=ZH3_ESpot_WorldWidePageHead -->

<link rel="stylesheet" type="text/css" href="/static/itxwebstandard/css/itx-core-main.min.css?t=20160727175509db" />

<script type="text/javascript" src="/static/itxwebstandard/js/itx-core-api.min.js?t=20160727175509db"></script>
<script type="text/javascript" src="/static/itxwebstandard/js/84009900/-5/80209919/ZH3_ESpot_I18N.min.js?t=20160730041000"></script>

<!-- Begin JS Attachments -->
<!-- End JS Attachments -->

<!-- Begin CSS Attachments -->
<!-- End CSS Attachments -->


<script type="text/javascript">
	inditex.iBrand = "zarahome";
	inditex.iBrandId = 8;
	inditex.iIsMobile = false;
	inditex.iIsMobileOn = false;
	inditex.iPage = "ItxWorldWidePage";
	inditex.iParams = {};
	inditex.iStoreId = 84009900;
	inditex.iStoreIdentifier = "ZaraHomeES";
	inditex.iLangId = -5;
	inditex.iCatalogId = 80209919;
	inditex.iLayout = "itxwebstandard";
	inditex.iRegistryTs = "20160730041000";
	inditex.iCustomTs = "20160727175509db";
	inditex.iProxyHostMobile = "www.zarahome.com";
	inditex.iProxyHostStandard = "www.zarahome.com";
	inditex.iProxyPortMobile = 80;
	inditex.iProxyPortStandard = 80;
	inditex.iProxySecurePortMobile = 443;
	inditex.iProxySecurePortStandard = 443;
	inditex.iProxyContextPathMobile = "/";
	inditex.iProxyContextPathStandard = "/";
	inditex.iSecureSet = ["ItxOrderLogonPage","ItxShopCartPage","ItxOrderPaymentPage","ItxPurchaseTunnelPage","ItxOrderConfirmationPage","ItxChangePassword","ItxStandardOneClickPreviewPage","ItxResetPasswordPage","ItxOrderShippingPage","ItxIFrameHelperPage"];
	inditex.iLocale = "es_ES";
	inditex.iCountryCode = "ES";
	inditex.iCountryName = "España";
	inditex.iSpotPrefix = "ZH3_ESpot_";
	inditex.iCategoryId = null;
	inditex.iCategoryKey = null;
	inditex.iProductId = null;
	inditex.iMaxLastProductListLength = 10;
	inditex.iAsyncPaymentPollingTries = 5;
	inditex.iAsyncPaymentPollingInterval = 5000;
	inditex.iGoogleMapsUser = "gme-itxecommerceireland";
	inditex.iGoogleMapsKey = "ABQIAAAAuLM0t2_kkFjBTv19NCnv4xQ1eARysJDSA6Rsmys1__vV4q3ogRSAPpMJQEtE6PZS8bUt68TqwWpmdA";
	inditex.iGoogleMapsChannel = "ZaraHome";
	inditex.iGaKeyAnt = "UA-2143769-1";
	inditex.iGaKey1 = null;
	inditex.iGaKey2 = null;
    inditex.iGooglePlacesKey = null;
    inditex.iGooglePlacesEnabled = false;
	inditex.iGaDomain = ".www.zarahome.com";
	inditex.iEnableUniversalAnalytics = null;
	inditex.iAppId = 1;
	inditex.iIsWebResponsive = true;
	inditex.iSolrPublicUrlServer = "www.zarahome.com/data";
	inditex.iTmpUrlLangStandard = true;
	inditex.iTmpUrlLangMobile = true;
	inditex.iMaxProductsShopCart = 25;
	inditex.iMaxProductsWishList = 1000;
	inditex.iGoogleMapsRegexPublic = "^$";
	inditex.iSecureEnabled = false;
</script>

<!-- Google Analytics -->
	<script type="text/javascript">
		var _gaq = _gaq || [];
		window['ga-disable-'+inditex.iGaKeyAnt] = true; 
		(function() {
			var ga = document.createElement('script');
			ga.type = 'text/javascript';
			ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0];
			s.parentNode.insertBefore(ga, s);
		})();
	</script>
<!-- End Google Analytics -->
<!-- END pre-common head -->
<link rel="shortcut icon" type="image/x-icon" href="/static/itxwebstandard/images/favicon.ico?t=20160727175509db" />
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1">
<link rel="apple-touch-icon" sizes="57x57" href="/static/itxwebstandard/images/zh_webmobile_icon_57x57.png?t=20160727175509db">
<link rel="apple-touch-icon" sizes="114x114" href="/static/itxwebstandard/images/zh_webmobile_icon_114x114.png?t=20160727175509db">
<link rel="apple-touch-icon" sizes="1024x1024" href="/static/itxwebstandard/images/zh_webmobile_icon_1024x1024.png?t=20160727175509db">

<script src="http://static.zarahome.net/8/static3/itxwebstandard/js/modernizr-custom.js?t=20160730041000"></script>
<script src="http://static.zarahome.net/8/static3/itxwebstandard/js/conditionizr_min.js?t=20160730041000"></script>

<!-- GTM - Datalayer -->
<script>
    dataLayer = [];
</script>
<!-- End Datalayer -->
<link rel="stylesheet" type="text/css" href="/static/itxwebstandard/css/itx-core-main-2.min.css?t=20160727175509db">
<!-- BEGIN SPOT=ZH3_ESpot_JL_Tracking -->

<!-- END SPOT=ZH3_ESpot_JL_Tracking -->
<!-- END page head -->

<!-- BEGIN post-common head -->
<script type="text/javascript" src="https://static.zarahome.net/8/static3/itxwebstandard/js/itx-custom-api.min.js?t=20160730041000"></script>

<!-- BEGIN SPOT=ZH3_ESpot_Inditex -->
<script type="text/javascript">
(function() {
    'use strict';

    // Events
    $('body').on('click', '.read-more', readMore);
    var transitionend = 'transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd';
    $('body').on(transitionend, '.read-more', animationEndReadMore);
    
    // Handlers
    function readMore() {
      /*jshint validthis:true */
        $(this).toggleClass('on');
        if ($(this).hasClass('on') && ($(this).closest('#bundle_info').length >= 1)) {
            $('.bundle-mini-list').addClass('hidden');
        }
    }

    function animationEndReadMore() {
        /*jshint validthis:true */
        if (!$(this).hasClass('on')) {
            $('.bundle-mini-list').removeClass('hidden');
        }
    }

    function readMoreInit() {
      $('.read-more').each( function() {   
          if ($(this).height() < 100) {
              $(this).addClass('off');
          }       
      });      
    }
    window.inditex.xReadMore = readMoreInit;
    
})();


(function() {
    'use strict';

  angular.module('itxApp').directive('fixes2', ['$rootScope', function($rootScope) {
    return {
      priority: 100,
      link: linkFn
    };

    function linkFn() {

      $rootScope.$watch(function() {
          angular.element('div[ng-if="product.detail.longDescription"]').addClass('read-more');
      });
    }

  }]);

  $(document).ready(function() {
    $('body').attr('fixes2', true);
  });

})();
</script><script type="text/javascript">
// FIX_TIENDAZHOME-4258

(function() {
  'use strict';

  angular.module('itxApp').factory('ItxShopCartFactory', itxShopCartFactory);

  itxShopCartFactory.$inject = [ '$q', '$rootScope','$timeout' ];

  function itxShopCartFactory($q, $rootScope,$timeout) {

    var service = {
      addSkuToShopCart : addSkuToShopCart,
      addProductToShopCart : addProductToShopCart,
      updateSkuQuantity : updateSkuQuantity,
      updateProductQuantity : updateProductQuantity,
      getShopCart : getShopCart,
      getShopCartCount : getShopCartCount,
      getJavascriptShopCart : getJavascriptShopCart,
      removeGiftPacking : removeGiftPacking,
      addGiftPacking : addGiftPacking,
      removeMessage: removeMessage,
      addPromoCode : addPromoCode,
      removePromoCode : removePromoCode,
      getCartProducts : getCartProducts
    };

    /**
     * Get the shopCart
     */
    function getShopCart() {
    	var deferred = $q.defer();
    	
    	inditex.execute({
    		'actions' : [ {
    			'action' : 'order:shoppingCart',
    			'params' : {
    				'languageId' : inditex.iLangId,
    				'storeId' : inditex.iStoreId
    			}
    		} ],
    		'onFinish' : function(status, response) {
          if (status === 1) {
            $timeout(function(){
              var cart = decoupleGiftPackingAndItemTaxes(response);
              cart = simplifyAdjustments(cart);
              deferred.resolve(cart);
              $rootScope.$emit('shopCartModelUpdated');
            });
          } else {
            deferred.reject(response);
          }
    		}
    	});
    	return deferred.promise;
    }
    
    /**
     * Get the shopCartCount
     */
    function getShopCartCount() {
      var count = inditex.iUserJSON.shopCart;
      return count;
    }
    
    /**
     * Get the getJavascriptShopCart
     */
    function getJavascriptShopCart() {
      var deferred = $q.defer();
      inditex.execute({
        'actions' : [ {
          'action' : 'user:loginGuest',
          'params' : {
            'languageId' : inditex.iLangId,
            'storeId' : inditex.iStoreId
          }
        } ],
        'onFinish' : function(status, response) {
          $timeout(function(){
            var cart = inditex.iUserJSON.shopCart;
            deferred.resolve(cart);
          });
        }
      });
      return deferred.promise;
    }

    /**
     * Get the shopCart
     */
    function getMiniShopCart() {
    	var deferred = $q.defer();
    	
    	inditex.execute({
    		'actions' : [ {
    			'action' : 'order:miniCart',
    			'params' : {
    				'languageId' : inditex.iLangId,
    				'storeId' : inditex.iStoreId
    			}
    		} ],
    		'onFinish' : function(status, response) {
    			$timeout(function(){
    				var cart = decoupleGiftPackingAndItemTaxes(response);
    				cart = simplifyAdjustments(cart);
    				deferred.resolve(cart);
    				$rootScope.$emit('shopCartModelUpdated');
    			});
    		}
    	});
    	return deferred.promise;
    }
    
    /**
     * Decouples giftPacking to avoid to be showed as a normal product
     */
    function decoupleGiftPackingAndItemTaxes(response) {
      response.itemTaxes = [];
      if(response.items){
        for (var i = 0; i < response.items.length; i++) {
          if (response.items[i].reference === 'XGIFTSKU') {
            response.giftPacking = true;
            response.items.splice(response.items.indexOf(response.items[i]), 1);
          }
        }
        for (var k = 0; k < response.items.length; k++) {
        	if (typeof response.items[k].tax !== 'undefined' && response.items[k].tax !== null && response.items[k].tax.length) {
        		for (var j = 0; j < response.items[k].tax.length; j++) {
                    response.items[k].tax[j].reference = response.items[k].reference;
                    response.itemTaxes.push(response.items[k].tax[j]);
        		}
        	}
        }
      }
      return response;
    }
    
    /**
     * Simplifies adjustments + promotions and separate shipping adjustments
     */
    function simplifyAdjustments(cart) {
      var totalNoShipping = 0;
      var totalShippingAdjustments = 0;
      var adjustments = [];
      
      
      cart.shippingAdjustments = [];
      if(cart.adjustment){
        for (var i = 0; i < cart.adjustment.length; i++) {
          if (cart.adjustment[i].isShipping) {
            cart.shippingAdjustments.push(cart.adjustment[i]);
            totalShippingAdjustments += parseInt(cart.adjustment[i].amount);
          } else {
            adjustments.push(cart.adjustment[i]);
            totalNoShipping += parseInt(cart.adjustment[i].amount);
          }
        }
      }
      
      cart.adjustment = adjustments;
      cart.totalNoShippingAdjustment = cart.totalProduct + totalNoShipping;
      cart.totalShippingAdjustments = totalShippingAdjustments;

      if(cart.itemTaxes){
    	  var totalTaxes = 0;
          var totalEcoTaxes = 0;

	      for (var i = 0; i < cart.itemTaxes.length; i++) {
	    	  totalTaxes += parseInt(cart.itemTaxes[i].price);
              if (cart.itemTaxes[i].name == "eco_tax"){
                  totalEcoTaxes += parseInt(cart.itemTaxes[i].price);
              }
	      }

	      cart.taxedTotalNoShippingAdjustment = cart.totalProduct + totalNoShipping +totalTaxes;
	      cart.totalTax = totalTaxes;
          cart.totalEcoTax = totalEcoTaxes;
      }
      return cart;
    }
    
//    /**
//     * Simplifies adjustments + promotions
//     */
//    function convertToPromotion(adjustment, cart) {
//      for (var i = 0; i < cart.promotion.length; i++) {
//        if (cart.promotion[i].description === adjustment.description) {
//          adjustment.description = cart.promotion[i].code;
//          adjustment.type = 'promoCode';
//        }
//      }
//
//      return adjustment;
//    }

    /**
     * Adds a product to the shopCart and $emit a event
     */
    function addSkuToShopCart(skuId, quantity, avoidOpenMinicart) {
      var deferred = $q.defer();

      $rootScope.$emit('shopCartChanging');

      var productToAdd = {};
      productToAdd.sku = skuId;
      productToAdd.quantity = quantity;

      inditex.execute({
        'actions' : [ {
          'action' : 'order:addToCart',
          'params' : {
            'languageId' : inditex.iLangId,
            'storeId' : inditex.iStoreId,
            'catalogId' : inditex.iCatalogId
          },
          'data' : {
            'cartItems' : [ productToAdd ]
          }
        } ],
        'onFinish' : function(status) {
          if(status === 1){
            // JETLORE
            var params = {
              USER_ID : inditex.iUserJSON.id,
              data    : {pid: productToAdd.productId, count: productToAdd.quantity}
            };
            $(document).trigger('jetLore-update', params);
            //GTM
            
            deferred.resolve(status);
          } else {
            deferred.reject(status);
          }

          if (avoidOpenMinicart === undefined) {
            $rootScope.$emit('shopCartChanged');
          } else {
            $rootScope.$emit('shopCartChangedNotOpenMinicart');
          }

        }
      });

      return deferred.promise;
    }
    
    /*
     * TODO Hotfix
     * Adds a whole product to the shopCart and $emit a event
     */
    function addProductToShopCart(product, avoidOpenMinicart) {
    	var deferred = $q.defer();

    	$rootScope.$emit('shopCartChanging');

    	inditex.execute({
    		'actions' : [ {
    			'action' : 'order:addToCart',
    			'params' : {
    				'languageId' : inditex.iLangId,
    				'storeId' : inditex.iStoreId,
    				'catalogId' : inditex.iCatalogId
    			},
    			'data' : {
    				'cartItems' : [ product ]
    			}
    		} ],
    		'onFinish' : function(status, response) {
    			if(status === 1){
            // JETLORE
            var params = {
              USER_ID : inditex.iUserJSON.id,
              data    : {pid: product.productId, count: product.quantity}
            };
            $(document).trigger('jetLore-update', params);
    				deferred.resolve(status);
    			} else {
            $rootScope.$broadcast('message-box:open', response.description);
    				deferred.reject(status);
    			}
          if (avoidOpenMinicart === undefined) {
            $rootScope.$emit('shopCartChanged');
          } else {
            $rootScope.$emit('shopCartChangedNotOpenMinicart');
          }
    		}
    	});
    	
    	return deferred.promise;
    }

    /**
     * Update product quantity on the shopCart and $emit a event
     * eventFrom will indicate 'reducido' or 'eliminado', depending on wether the user
     * has pushed de decrease button or the remove button. It will be ignored when adding.
     */
    function updateSkuQuantity(itemId, quantity, eventFrom) {
      var deferred = $q.defer();

      $rootScope.$emit('shopCartChanging');

      var productToUpdate = {};
      productToUpdate.id = itemId;
      productToUpdate.quantity = quantity;

      var data = {};
      data.cartItems = [];
      data.cartItems.push(productToUpdate);
      
      var pid ="";
      var product;
      for (var i = 0; i < inditex.iUserJSON.shopCart.items.length; i++) {
        var item = inditex.iUserJSON.shopCart.items[i];
        if(item.id === productToUpdate.id){
          product = item;
          pid = item.parentId;
          break;
        }
      };
      if(productToUpdate.quantity === 0){
        // JETLORE
        $(document).trigger('jetLore-remove', {
          data    : {pid: pid, count: productToUpdate.quantity}
        });
      }else{
        // JETLORE
        $(document).trigger('jetLore-update', {
          data    : {pid: pid, count: productToUpdate.quantity}
        });
      }

      var itemsNoStock = _
          .chain(inditex.iUserJSON.shopCart.items)
        .filter(function(item){
          return item.availability !== 'in_stock';
        })
        .value()
        .length;
        var msg = product.quantity > quantity ? 'checkout-remove-to-cart' : 'checkout-add-to-cart';
        product.parentReference = product.reference;
        product.deltaQuantity = Math.abs(product.quantity - quantity);
       
    
      inditex.execute({
        'actions' : [ {
          'action' : 'order:updateCart',
          'params' : {
            'languageId' : inditex.iLangId,
            'storeId' : inditex.iStoreId,
            'catalogId' : inditex.iCatalogId
          },
          'data' : {
            'cartItems' : [ productToUpdate ]
          }
        } ],
        'onFinish' : function(status) {
          deferred.resolve(status);
          $rootScope.$emit('forceShopCartChanged');
          var gtmData = {
            'cartNumberItems': inditex.iUserJSON.shopCart.items.length.toString(),
            'cartNumberItemsNoStock': itemsNoStock.toString(),
            'reference' : product.reference,
            'cartProductsEnhanced': [product],
            'productSize' : product.size
          };
          gtmData.eventFrom = eventFrom || 'reducido';
            
          $(document).trigger('GTM-push', [msg, gtmData]);
        }
      });

      return deferred.promise;
    }
    
    /**
     * TODO HOTFIX
     * Update product quantity on the shopCart and $emit a event
     */
    function updateProductQuantity(item, quantity) {
    	var deferred = $q.defer();
    	
    	$rootScope.$emit('shopCartChanging');
    	
    	var productToUpdate = item;
    	productToUpdate.quantity = quantity;
    	
    	var data = {};
    	data.cartItems = [];
    	data.cartItems.push(productToUpdate);
    	
    	inditex.execute({
    		'actions' : [ {
    			'action' : 'order:updateCart',
    			'params' : {
    				'languageId' : inditex.iLangId,
    				'storeId' : inditex.iStoreId,
    				'catalogId' : inditex.iCatalogId
    			},
    			'data' : {
    				'cartItems' : [ productToUpdate ]
    			}
    		} ],
    		'onFinish' : function(status) {
    			deferred.resolve(status);
    			$rootScope.$emit('shopCartChanged');
    		}
    	});
    	
    	return deferred.promise;
    }

    /**
     * Remove a giftPacking on the shopCart and $emit a event
     */
    function removeGiftPacking(orderId) {
      var deferred = $q.defer();

      $rootScope.$emit('shopCartChanging');
      
      var actions = [];
      
      actions.push({
    	  'action' : 'order:deleteGiftPacking',
          'params' : {
            'languageId' : inditex.iLangId,
            'storeId' : inditex.iStoreId,
            'orderId' : orderId
          }
      });
      
      actions.push({
          'action' : 'order:getGiftTicket',
          'params' : {
            'languageId' : inditex.iLangId,
            'storeId' : inditex.iStoreId,
            'orderId' : orderId,
            'gifticket' : 0
          }
      });

      inditex.execute({
        'actions' : actions,
        'onFinish' : function(status) {
          deferred.resolve(status);
          $rootScope.$emit('shopCartChanged');
        }
      });

      return deferred.promise;
    }

    /**
     * Adds a giftPacking on the shopCart and $emit a event
     */
    function addGiftPacking(orderId, message) {
      var deferred = $q.defer();

      $rootScope.$emit('shopCartChanging');
      
      var actions = [];
      
      actions.push({
          'action' : 'order:addGiftpacking',
          'params' : {
            'languageId' : inditex.iLangId,
            'storeId' : inditex.iStoreId,
            'orderId' : orderId,
            'message' : message || ''
          }
      });
      
      actions.push({
          'action' : 'order:getGiftTicket',
          'params' : {
            'languageId' : inditex.iLangId,
            'storeId' : inditex.iStoreId,
            'orderId' : orderId,
            'gifticket' : 1
          }
      });

      inditex.execute({
        'actions' : actions,
        'onFinish' : function(status, response) {
        	if (status == 1) {
        		deferred.resolve(status);
                $rootScope.$emit('shopCartChanged');
        	} else {
        		deferred.reject(response);
        	}
        }
      });

      return deferred.promise;
    }
    
    /**
     * remove personal message
     */
    function removeMessage(orderId) {
        var deferred = $q.defer();

      $rootScope.$emit('shopCartChanging');
      
      var actions = [];
      
      actions.push({
          'action' : 'order:deleteGiftPacking',
          'params' : {
            'languageId' : inditex.iLangId,
            'storeId' : inditex.iStoreId,
            'orderId' : orderId,
            'onlyMessage' : true
          }
      });
      
      inditex.execute({
        'actions' : actions,
        'onFinish' : function(status) {
          deferred.resolve(status);
          $rootScope.$emit('shopCartChanged');
        }
      });

      return deferred.promise;
    }

    /**
     * Adds a promo code to the shopCart and $emit a event
     */
    function addPromoCode(orderId, newPromoCode) {
      var deferred = $q.defer();

      $rootScope.$emit('shopCartChanging');

      inditex.execute({
        'actions' : [ {
          'action' : 'order:addPromoCode',
          'params' : {
            'languageId' : inditex.iLangId,
            'storeId' : inditex.iStoreId,
            'orderId' : orderId
          },
          'data' : {
            'promoCode' : newPromoCode
          }
        } ],
        'onFinish' : function(status) {
          deferred.resolve(status);
          $rootScope.$emit('shopCartChanged');
        }
      });

      return deferred.promise;
    }

    /**
     * Remove a promo code to the shopCart and $emit a event
     */
    function removePromoCode(orderId, promoCode) {
      var deferred = $q.defer();

      $rootScope.$emit('shopCartChanging');

      inditex.execute({
        'actions' : [ {
          'action' : 'order:deletePromoCode',
          'params' : {
            'languageId' : inditex.iLangId,
            'storeId' : inditex.iStoreId,
            'orderId' : orderId,
            'promoCode' : promoCode
          }
        } ],
        'onFinish' : function(status) {
          deferred.resolve(status);
          $rootScope.$emit('shopCartChanged');
        }
      });

      return deferred.promise;
    }
    
    /**
     * gets a dictionary of items. Each key will be a product id, and the value will be the product detail
     */
    function getCartProducts(items) {
        var deferred = $q.defer();
        
        var actions = [];
        for (var i = 0; i < items.length; i++) {
            actions.push({
               'action' : 'catalog:productDetail',
               'params' : {
                    'storeId' : inditex.iStoreId,
                    'catalogId' : inditex.iCatalogId,
                    'languageId' : inditex.iLangId,
                    'categoryId' : 0,
                    'productId' : items[i].parentId
               }
            });
        }
        inditex.execute({
            'actions' : actions,
            'onFinish' : function(status) {
                if (status == 1) {
                    var o = {};
                    for (var i = 1; i < arguments.length; i++) {
                        var product = arguments[i];
                        o[product.id] = product;
                    }
                    deferred.resolve(o);
                } else deferred.reject(arguments[1]);
            }
        });
        
        return deferred.promise;
    }

    return service;

  }

}());

// END_FIX_TIENDAZHOME-4258
</script><script type="text/javascript">
// FIX_TIENDAZHOME-4276

(function() {
  'use strict';

  angular.module('itxApp').controller('ItxOrderShippingPageCtrl', itxOrderShippingPageCtrl);

  /* jshint maxlen: 200 */
  itxOrderShippingPageCtrl.$inject = ['ItxUserManagementFactory', 'ItxShippingMethodsFactory', 'ItxShopCartFactory', 'ItxAddressBookFactory', 'ItxPhysicalStoresFactory', 'ItxPaymentProcessCommonsFactory','ItxShippingAddressFactory' , '$sce', '$window', '$q', '$scope', '$rootScope', 'gConstants', '$timeout' ];

  function itxOrderShippingPageCtrl(itxUserManagementFactory , itxShippingMethodsFactory, itxShopCartFactory, itxAddressBookFactory, itxPhysicalStoresFactory, itxPaymentProcessCommonsFactory,ItxShippingAddressFactory, $sce, $window, $q, $scope, $rootScope, gConstants, $timeout) {
    
    // Set last page url in scope
    itxPaymentProcessCommonsFactory.getLastPage();
    itxPaymentProcessCommonsFactory.getStoreUrl();
    itxPaymentProcessCommonsFactory.setIsKids();
    
    /* jshint validthis: true */
    var self = this;

    self.genericError = undefined;
    self.deliveryAreaMessage = undefined;
    
    self.registered = false;
    self.cart = undefined;
    self.orderId = undefined;
    self.billingZipCode = undefined;
    self.billingAddresId = undefined;
    self.billingEmail = undefined;
    self.blockSaveButton = false;
    self.addressesLoaded = false;
    self.hasDelivery = false;
    self.validDeliveryMethod = null; //método de envío a domicilio que corresponde con el código postal actual
    
    self.originalAddressBook = undefined;
    
    self.getShippingMethodUrl = getShippingMethodUrl;

    /** Shipping method selection */
    self.shippingMethods = undefined;
    self.allShippingMethods = [];
    self.validSubFamiliesForDroppointRegExp = null;
    self.itemSubFamilyMap = {};
    self.itemSubFamilyArray = [];
    self.selectedShippingMethod = undefined;
    self.selectShippingMethod = selectShippingMethod;
    self.formatPrice = formatPrice;
    self.getVatinValidation = getVatinValidation;
    self.getPhoneValidation = getPhoneValidation;
    self.sameBillingAddressChanged = sameBillingAddressChanged;
    self.states = [];

    /** delivery */
    self.shippingAddress = {};
    self.billingAddress = {};
    self.sameBillingAddress = true;
    self.modifyAddress = false;
    /** stores */
    self.storeSelection = {};

    /** droppoint */
    self.droppointSelection = {};
    
    self.closeMap = closeMap;

    self.showMiddleName = inditex.iStoreJSON.details.isMiddleName;
    self.countryCode = inditex.iStoreJSON.countryCode;
    self.countryName = inditex.iStoreJSON.countryName;
    self.phoneCountryCode = inditex.iStoreJSON.details.phoneCountryCode;
    self.setContactDataIsCompany = setCDC;
    self.isUserGuest = inditex.iUserJSON.userType === 'G';
    self.userType = $scope.userType = inditex.iUserJSON.userType; 
    self.zipCodeSearched = null;
    itxUserManagementFactory.getUserType().then(function(result){
    	self.userType = $scope.userType = result;
    });
    self.isCompanyAllowed = inditex.iStoreJSON.details.isCompanyAllowed;
    self.requireCifDisabledFront = inditex.iStoreJSON.details.requireCifDisabledFront;
    /** to payment page */
    self.loading = undefined;
    self.goToPaymentMethodPage = goToPaymentMethodPage;
    self.getRestrictedZipCodeShippingMethods = getRestrictedZipCodeShippingMethods;
    self.openRussiaMap = openRussiaMap;
    
    self.deliveryDates = [];
    self.deliveryDate = undefined;
    self.deliveryTimeRanges = [];
    self.deliveryTimeRange = undefined;
    
    //$rootScope.notShowShippingDiscount = true;
    
    self.trustHtml = trustHtml;
    
    self.busy = true;
    self.sendToAnotherAddress = false;
    
    self.getBillingAddressFullName = getBillingAddressFullName;
    self.getFullAddress = getFullAddress;
    self.popUpAddressWindow = popUpAddressWindow;
    self.editAddress = editAddress;
    self.setAddressToEdit = setAddressToEdit;
    self.closeAddressWindow = closeAddressWindow;
    
    
    $rootScope.$on('$viewContentLoaded', function(event) {
      $timeout(function() {
        self.busy=false;
      },0);
    });

    $rootScope.$on('$viewContentNotLoaded', function(event) {
    	$timeout(function() {
    		self.busy=true;
    	},0);
    });

    $rootScope.$on('address.billing.zipcode.restricted.validation.request',function(event,zipCode){
      if(hasToCheckRestrictedZipCodes()){
        getRestrictedZipCodeShippingMethods(zipCode);        
        performRestrictedZipCodeValidation(zipCode,'billing');
      }
    });

    $rootScope.$on('address.shipping.zipcode.restricted.validation.request',function(event,zipCode){
      if(hasToCheckRestrictedZipCodes()){
	  	  getRestrictedZipCodeShippingMethods(zipCode);
         performRestrictedZipCodeValidation(zipCode,'shipping');  
      }
    });

    $rootScope.$on('address.shipping.update.shipping.methods.request',function(event,zipCode){
      if(hasToCheckRestrictedZipCodes()){
        getRestrictedZipCodeShippingMethods(zipCode);
        performRestrictedZipCodeValidation(zipCode, 'shipping');
        unblockSaveButton();
      }
    });

    $rootScope.$on('address.shipping.updateAdress',function(event, modifyAddress){
        self.modifyAddress = modifyAddress;

        //Reset generic error
        if (!modifyAddress) {
          self.genericError = undefined;
        }
    });

    $rootScope.$on('addressComponent.address.form.reseted', function() {
      self.genericError = undefined;
    });
    
    $rootScope.$on('updateShippingMethod',function(){
    	if (!self.loading) {
    		goToPaymentMethodPage(true);
    	}
    });

    $rootScope.$on('zipCodeChanged',function(event, zipCode){
        self.zipCodeSearched = zipCode;
        self.storeSelection.initialInput = zipCode
      });
    
    init();

    function trustHtml(message) {
      return $sce.trustAsHtml(message);
    }
    /**
     * Gets the nif validation, if is cif and exists overrides with cif
     * validation
     */
    function getVatinValidation(isCif) {
      var regexp = gConstants.validations.vatin.nif[self.countryCode];
      if (isCif) {
        var regexpCif = gConstants.validations.vatin.cif[self.countryCode];
        if (regexpCif !== undefined) {
          regexp = regexpCif;
        }
      }
      return regexp;
    }
    
    /**
     * Init
     */
    function init() {
      self.cart = inditex.iUserJSON.shopCart;
//      if(self.cart.taxArray && self.cart.taxArray.length > 0 && self.cart.isNoNexus!='1'){
//    	  delete $rootScope.notShowShippingDiscount;
//      }
      self.orderId = self.cart.id;
      getAddressBook().then(function(){
    	  
    	  //load valid subfamilies for droppoint
    	  itxShippingMethodsFactory.getDroppointAllowedSubFamilies().then(function(regExp) {
    		  self.validSubFamiliesForDroppointRegExp = regExp;
    		  getShippingMethods();
    	  })['catch'](function(error){
    		  self.genericError = error.description;
    		  self.loading = false;
    		  self.shippingAddress.$submitted = false;
    		  self.billingAddress.$submitted = false;
    		  self.storeSelection.$submitted = false;
    		  self.droppointSelection.$submitted = false;
    	  });
      });
      
      
      itxShippingMethodsFactory.getdeliveryDates(self.orderId).then(function(response) {
    	  if (response && response.length > 0) {
    		  for(var i=0;i<10;i++) {
        		  if (response[i]) {
        			  self.deliveryDates.push({
        				'datetime': response[i].datetime,
        				'formattedDate': new Date(response[i].datetime).dateFormat('l, Y-m-d')
        			  });
        		  }
        	  }
    	  }
      });
      
      itxShippingMethodsFactory.getDeliveryTimeRanges(self.orderId).then(function(response) {
        self.deliveryTimeRanges = response;
      });   

      
      $(document).trigger('GTM-push', ['checkout-envio', {
        'orderId' : self.orderId,
        'cartProductsEnhanced' : self.cart.items
      }]);
  
      //ADS tracking
        var productIds = [];
        for (var i = 0; i < self.cart.items.length; i++) {
            productIds.push(self.cart.items[i].parentId.toString());
        }

        $(document).trigger('hellomedia-track', {
           'pageName' : encodeURIComponent(inditex.iStoreJSON.hostname + "|" + inditex.iStoreJSON.countryCode + "|Basket"),
           'step' : 2,
           'orderid' : self.cart.id.toString(),
           'sales' : String(inditex.formatNumber(self.cart.totalOrder)),
           'productIds' : productIds
        });

    }
    
    /**
     * returns a promise which, when resolved, will indicate whether there are 
     * products not allowed to be delivered via drop point
     */
    function _checkForNotAllowedSubFamilies() {
        if (!self.validSubFamiliesForDroppointRegExp) {
            var deferred = $q.defer();
            deferred.resolve(false);
            return deferred.promise;
        } else {
            var deferred = $q.defer();
            //check if there are products in the cart without detail loaded
            var itemsToLoad = [];
            //we must refill the map, because products may be removed from the cart.
            var newMap = {};
            for (var i = 0; i < self.cart.items.length; i++) {
                var item = self.cart.items[i];
                if (self.itemSubFamilyMap[item.parentId] === undefined) itemsToLoad.push(item);
                else newMap[item.parentId] = self.itemSubFamilyMap[item.parentId];
            }
            self.itemSubFamilyMap = newMap;
            if (itemsToLoad.length) {
                itxShopCartFactory.getCartProducts(itemsToLoad).then(function(productMap) {
                    
                    for (var id in productMap) {
                        self.itemSubFamilyMap[id] = productMap[id].subFamily;
                    }
                    deferred.resolve(_testForNotAllowedSubFamilies());
                })['catch'](function(error){
                    deferred.reject(error);
                });
            } else { //no new products in cart.
                deferred.resolve(_testForNotAllowedSubFamilies());
            }
            
            return deferred.promise;
        }
    }
    
    function _testForNotAllowedSubFamilies() {
        for (var id in self.itemSubFamilyMap) {
            var subFamily = self.itemSubFamilyMap[id];
            if (!self.validSubFamiliesForDroppointRegExp.test(subFamily)) {
                return true;
            }
        }
        return false;
    }
    

    function sameBillingAddressChanged() {
      if (self.sameBillingAddress) {
        self.genericError = undefined;
		if(hasToCheckRestrictedZipCodes()){
			getRestrictedZipCodeShippingMethods(self.billingAddress.address.zipCode);
			}
        performRestrictedZipCodeValidation(self.billingAddress.address.zipCode, "billing");
      }
    }

    function setupCreateBillingAddressData(){
        self.sameBillingAddress = true;
    }

    /**
     * Cierra el mapa
     */
    function closeMap() {
      self.droppointSelection.showMap = false;
      self.droppointSelection.initialInput = undefined;
      self.storeSelection.showMap = false;
      self.storeSelection.initialInput = undefined;
    }

    /**
     * Select the shipping method and fetch needed info if not previously
     * fetched
     */
    function selectShippingMethod(shippingMethod) {
        self.deliveryAreaMessage = undefined;
    	if (!self.loading && shippingMethod.id != 'fake') {
    		self.genericError = '';
    	      selectShippingMethodyId(shippingMethod.id);
    	      self.blockSaveButton = false;
    	      self.selectedShippingMethod = shippingMethod;
    	      $rootScope.shippingPrice = shippingMethod.price;
    	      $timeout(function(){
    	    	  goToPaymentMethodPage(true);
    	      });
    	}
        
//        if (inditex.iCountryCode == 'RU' && self.validDeliveryMethod && self.selectedShippingMethod 
//                && self.selectedShippingMethod.kind == 'delivery' && self.selectedShippingMethod.id != self.validDeliveryMethod.id) {
//            self.deliveryAreaMessage = inditex.text('ItxOrderShippingPage.noValidZipCodeForArea', self.validDeliveryMethod.name);
//        }
    }

    /**
     * Formats the prices
     */
    function formatPrice(price) {
      return $sce.trustAsHtml(inditex.formatPrice(price));
    }

    function setCDC(iscomp) {
      self.billingAddress.address.isCompany = iscomp;
      if (iscomp) {
        self.billingAddress.address.company = self.billingAddress.companyData || {};
      } else {
        self.billingAddress.address.company = null;
      }
    }
    
    function manageSetDeliveryAddressError(error){
        self.genericError = error.description;
        //init();
        self.loading = false;
        self.shippingAddress.$submitted = false;
        self.billingAddress.$submitted = false;
        self.storeSelection.$submitted = false;
        self.droppointSelection.$submitted = false;
    }

    function setupShippingAddressFactory(){
      ItxShippingAddressFactory.shippingAddress = self.shippingAddress;
      ItxShippingAddressFactory.billingAddress = self.billingAddress;
      ItxShippingAddressFactory.originalAddressBook = self.originalAddressBook;      
      ItxShippingAddressFactory.externalSetShippingMethod = setShippingMethod;
      ItxShippingAddressFactory.externalManagePaymentError = manageSetDeliveryAddressError;
    }

    function goToPaymentMethod(){
      trackSelectionWithGTM();
      $window.location.href = getPaymentMethodUrl();
    }
    
    function trackSelectionWithGTM() {
      var idStore = (self.storeSelection.store) ? self.storeSelection.store.id : null;
      var oAddress = self.sameBillingAddress ? self.billingAddress : self.shippingAddress;
      var zipCode = (oAddress.address) ? oAddress.address.zipCode : null;
      $(document).trigger('GTM-push', ['checkout-envio-seleccion', {
              'shippingType' : self.selectedShippingMethod.kind,
              'shippingTypeAddress' : 'mis_direcciones',
              'billingTypeAddress' : 'mis_direcciones',
              'shippingStore' : idStore,
              'shippingZipCode' : zipCode
      }]);
    }

    function setDeliveryAddress(stayInPage){
      setupShippingAddressFactory();
      if(self.sameBillingAddress === true){  
        if(self.sendToAnotherAddress){
          ItxShippingAddressFactory.saveBillingAddress().then(function(data){
            ItxShippingAddressFactory.setShippingAddressAsDeliveryAddress().then(function() {
            	if (!stayInPage) {
            		goToPaymentMethod();	
            	}
            	setTimeout(function() {
            		self.loading = false;
            		$scope.$apply();
            	}, 500);
            }, function(data){
            	self.loading = false;
            	self.genericError = data.description;
            	self.sendToAnotherAddress = false;
            	})['catch'](manageSetDeliveryAddressError);            
          }, function(data){
        	self.loading = false;
        	self.genericError = data.description;
        	self.sendToAnotherAddress = false;
        	})['catch'](manageSetDeliveryAddressError);
        }
        else{
          ItxShippingAddressFactory.setBillingAddressAsDeliveryAddress(inditex.iUserJSON.userType === 'G').then(function() {
          	if (!stayInPage) {
        		goToPaymentMethod();	
        	}
          	setTimeout(function() {
        		self.loading = false;
        		$scope.$apply();
        	}, 500);
        }, function(data){
        	self.loading = false;
        	self.genericError = data.description?data.description:data;
        	})['catch'](manageSetDeliveryAddressError);
        } 
      }
      else{
        ItxShippingAddressFactory.xAsDeliveryAddress(self.modifyAddress).then(function() {
        	if (!stayInPage) {
        		goToPaymentMethod();	
        	}
        	self.loading = false;
        }, function(data){
        	self.loading = false;
        	self.sameBillingAddress = true;
        	self.sendToAnotherAddress = false;
        	self.genericError = data.description;
        	})['catch'](manageSetDeliveryAddressError);
      }
    }

    /**
     * Go to payment method selection page
     */
    function goToPaymentMethodPage(stayInPage) {
            
		if (!stayInPage) {
	      self.shippingAddress.$submitted = true;
	      self.billingAddress.$submitted = true;
	      self.storeSelection.$submitted = true;
	      self.droppointSelection.$submitted = true;
		} else {
			if (((self.selectedShippingMethod.kind === 'droppoint' || self.selectedShippingMethod.kind === 'itxdroppoint' || self.selectedShippingMethod.kind === 'dropbox') && !self.droppointSelection.droppoint) || 
					(self.selectedShippingMethod.kind === 'pickup' && !self.storeSelection.store)) {
				$scope.shippingMethodsForm.$valid = false;
			}
		}
		
		if(self.selectedShippingMethod.id =='fake'){
			return;
		}
                
                if (self.deliveryAreaMessage) return;
		
      $scope.shippingMethodsForm.$submitted = true;
      
 	  if($scope.shippingMethodsForm.contactData && !$scope.shippingMethodsForm.contactData.$valid){
 		  $scope.shippingMethodsForm.$valid = false;
 	  }
      
      if(isSaveButtonBlocked()){
        $scope.shippingMethodsForm.$valid = false;        
      }
      
      if ($scope.shippingMethodsForm.$valid) {
        self.loading = true;
        if(self.selectedShippingMethod.kind === 'delivery' ||  self.selectedShippingMethod.kind === 'definedDeliveryDate'){
          //necesitamos comprobar que la dirección de facturación contiene un teléfono válido.
          //puede perderse si el número de teléfono no es válido según las expresiones regulares de validación y se cambia el método de pago 
          //entre envío a domicilio y otros tipos de pago.
          if (!self.billingAddress.address.phones[0].subscriberNumber)
              self.billingAddress.address.phones[0].subscriberNumber = self.originalAddressBook.addresses[0].phones[0].subscriberNumber;
          setDeliveryAddress(stayInPage);
        }
        else{
          if (angular.toJson(self.billingAddress.address) === angular.toJson(self.originalAddressBook.addresses[0])) {
            //We need to save the shipping data (deliveryAddress / dp / store, etc...)
            fullfitShippingData().then(function(shippingData) {
              
              //We set the shipping method and do checkout
              setShippingMethod(shippingData).then(function(data) {
                if (!stayInPage) {
                        trackSelectionWithGTM();
                	$window.location.href = getPaymentMethodUrl();
                }
                self.loading = false;
              //Error doing shippingCheckout
              })['catch'](function(error){
            	if(!stayInPage){
	                self.genericError = error.description;
	                init();
	                self.shippingAddress.$submitted = false;
	                self.billingAddress.$submitted = false;
	                self.storeSelection.$submitted = false;
	                self.droppointSelection.$submitted = false;
            	}
            	self.loading = false;
              });
              
            }, function(data){
            	self.loading = false;
            	self.genericError = data;
            }
            );
          } else {
            self.billingAddress.address.addressName = 'billingAddress#' + self.billingAddress.address.email;
            self.billingAddress.address.phones[0].countryCode = self.phoneCountryCode;
            itxAddressBookFactory.addOrUpdateAddress(self.billingAddress.address).then(function(billingAddressId) {
              self.billingAddress.address.id = billingAddressId.id;
              
              //We need to save the shipping data (deliveryAddress / dp / store, etc...)
              fullfitShippingData().then(function(shippingData) {
                
                //We set the shipping method and do checkout
                setShippingMethod(shippingData).then(function(data) {
                	if (!stayInPage) {
                                trackSelectionWithGTM();
                		$window.location.href = getPaymentMethodUrl();
                	}
                	self.loading = false;
                //Error doing shippingCheckout
                })['catch'](function(error){
                  self.genericError = error.description;
                  init();
                  self.loading = false;
                  self.shippingAddress.$submitted = false;
                  self.billingAddress.$submitted = false;
                  self.storeSelection.$submitted = false;
                  self.droppointSelection.$submitted = false;
                });
                
              }, function(data){
            	self.loading = false;
            	self.generalError = data;
            });
              
            //Error updating billing address
            })['catch'](function(error){
                self.genericError = error.description;
                init();
                self.loading = false;
                self.shippingAddress.$submitted = false;
                self.billingAddress.$submitted = false;
                self.storeSelection.$submitted = false;
                self.droppointSelection.$submitted = false;
            });
          }
        }
      }
    }
    
    
    /**
     * Fullfit shipping data
     */
    function fullfitShippingData() {
      var deferred = $q.defer();

      var shippingData = {};
      if (self.selectedShippingMethod.kind === 'delivery' || self.selectedShippingMethod.kind === 'definedDeliveryDate') {
        fullfitDeliveryData().then(function(data) {
          deferred.resolve(data);
        });
        
      } else if (self.selectedShippingMethod.kind === 'droppoint' || self.selectedShippingMethod.kind === 'itxdroppoint' || self.selectedShippingMethod.kind === 'dropbox') {
        if(self.droppointSelection.droppoint){
	        self.contactData = {
	            firstName : self.billingAddress.address.firstName,
	            middleName : self.billingAddress.address.middleName,
	            lastName : self.billingAddress.address.lastName,
	            countryCode : self.billingAddress.address.countryCode,
	            countryName : self.billingAddress.address.countryName,
	            email : self.billingAddress.address.email,
	            phones : self.billingAddress.address.phones
	        };
	        if(self.selectedShippingMethod.kind === 'dropbox'){
	        	self.contactData.dropboxCIF = self.dropboxCIF;
	        }
	        
	        itxAddressBookFactory.addDropPointAddress(self.contactData, self.droppointSelection.droppoint, self.selectedShippingMethod.kind !== 'dropbox', self.states).then(function(addressId) {
	          shippingData.addressId = addressId.id;
	          deferred.resolve(shippingData);
	        })
	        ['catch'](function(error){
	            self.genericError = error.description;
	            init();
	            self.loading = false;
	            self.shippingAddress.$submitted = false;
	            self.billingAddress.$submitted = false;
	            self.storeSelection.$submitted = false;
	            self.droppointSelection.$submitted = false;
	        });
	        }
        else{
        	deferred.reject(inditex.text('SHIPPING_SELECT_STORE'));
        }
      } else if (self.selectedShippingMethod.kind === 'pickup') {
    	  if(self.storeSelection.store && self.storeSelection.store.id){
    		  shippingData.physicalStoreId = self.storeSelection.store.id;
    		  deferred.resolve(shippingData);
    	  }
    	  else{
    		  deferred.reject(inditex.text('SHIPPING_SELECT_STORE'));
    	  }
          
      } else if (self.selectedShippingMethod.kind === 'mail') {
          shippingData.addressId = self.billingAddress.address.id;
          deferred.resolve(shippingData);
          
      } else {
        self.genericError = 'Shipping method not supported';
        init();
        self.loading = false;
        self.shippingAddress.$submitted = false;
        self.billingAddress.$submitted = false;
        self.storeSelection.$submitted = false;
        self.droppointSelection.$submitted = false;
      }

      return deferred.promise;
    }

    /**
     * Saves the addresses and sets shipping data
     */
    function fullfitDeliveryData() {

      var deferred = $q.defer();

      var shippingAddressModified = true;
      for (var i=1; i<self.originalAddressBook.addresses.length;i++) {
        if (self.shippingAddress.address.id === self.originalAddressBook.addresses[i].id) {
          if (angular.toJson(self.shippingAddress.address) === angular.toJson(self.originalAddressBook.addresses[i])) {
            shippingAddressModified = false;
          }
        }
      }

      if (shippingAddressModified) {
        self.shippingAddress.address.isShippingAddress = true;
        itxAddressBookFactory.addOrUpdateAddress(self.shippingAddress.address).then(function(shippingAddressId) {
          self.shippingAddress.address.id = shippingAddressId.id;
          var shippingData = {};
          shippingData.addressId = self.shippingAddress.address.id;
          deferred.resolve(shippingData);
        })['catch'](function(error){
          self.genericError = error.description;
          init();
          self.loading = false;
          self.shippingAddress.$submitted = false;
          self.billingAddress.$submitted = false;
          self.storeSelection.$submitted = false;
          self.droppointSelection.$submitted = false;
        });
      } else {
        var shippingData = {};
        shippingData.addressId = self.shippingAddress.address.id;
        deferred.resolve(shippingData);
      }

      return deferred.promise;
    }
    
    function getAddressBook() {
      var deferred = $q.defer();
      itxAddressBookFactory.getStates().then(function(states) {
        self.states = states;
        itxAddressBookFactory.getAddressBook().then(function(addressBook) {
          cleanAddressBook(addressBook);
          self.originalAddressBook = JSON.parse(angular.toJson(addressBook));
          setBillingAddress(addressBook, states);
          itxUserManagementFactory.getUserType().then(function(result){
               self.userType = $scope.userType = result;
               setupCreateBillingAddressData();
          });
          $rootScope.$emit('$viewContentLoaded');
          self.addressesLoaded = true;
          self.storeSelection.initialInput = addressBook.addresses.length ? addressBook.addresses[0].zipCode : undefined;
          //delay so the framework has time to update the initialInput binding.
          deferred.resolve();
          setTimeout(function() {
            $rootScope.$emit('$userAddressesLoaded');
          }, 50);
        },function(error){
        	deferred.reject(error);
        });
      });
      return deferred.promise;
    }


    function cleanShippingMethodsIfVC(){
       for (var i=0; i<self.cart.items.length;i++) {
        if (self.cart.items[i].productType === 'Virtual Card') {
          var emailShippingMethod = {name : 'Mail', description : 'Mail', price : 0, kind : 'mail', code : 3, id:'-1'};
          var shippingMethods = [emailShippingMethod];
          self.shippingMethods = shippingMethods;
          preselectShippingMethod();
          return;
        }
      }
    }
    /**
     * Get the shipping methods available
     */
    function getShippingMethods() {
      cleanShippingMethodsIfVC();
      if (inditex.iStoreJSON.details.postalCodeRestriction !== '0') {
    	  if(self.billingZipCode){
                  //cargamos siempre todos los métodos de envío, para tenerlos cacheados.
                  itxShippingMethodsFactory.getShippingMethods(self.orderId).then(function(shippingMethods) {
                      if (inditex.iCountryCode == 'RU') {
                        for (var i = 0; i < shippingMethods.length; i++) {
                            var method = shippingMethods[i];
                            if (method.id == 156902) continue; //evitar el método envío estándar sin zona.
                            if (method.kind == 'pickup') self.allShippingMethods.unshift(method);
                            else self.allShippingMethods.push(method);
                        }
                    } else self.allShippingMethods = shippingMethods;
                      return itxShippingMethodsFactory.getShippingMethodsByZipCode(self.billingZipCode)
                  }).then(loadShippingMethods);
    	  }
    	  else{
    		  itxShippingMethodsFactory.getShippingMethods(self.orderId).then(loadShippingMethods);
    	  }
      } else {
        itxShippingMethodsFactory.getShippingMethods(self.orderId).then(function(shippingMethods) {
            _checkForNotAllowedSubFamilies().then(function(notAllowedSubFamilies) {
                self.shippingMethods = itxShippingMethodsFactory.filterShippingMethods(notAllowedSubFamilies, shippingMethods);
                preselectShippingMethod();
            })['catch'](function(error) {
                self.genericError = error.description;
                self.loading = false;
                self.shippingAddress.$submitted = false;
                self.billingAddress.$submitted = false;
                self.storeSelection.$submitted = false;
                self.droppointSelection.$submitted = false;
            });
        });
      }
    }

    /**
     * Preselect the shipping method
     */
    function preselectShippingMethod() {
    	
      var shippingMethodSelected=false;
      for (var i = 0; i < self.shippingMethods.length; i++) {
    	if(self.shippingMethods[i].selected){
    		shippingMethodSelected = true;
    		break;
    	}
      }
    
      var preselectedFromCart = false;
      if(!shippingMethodSelected){
	      if (self.cart.shipping && self.cart.shipping.shippingMethodId) {
	        preselectedFromCart = selectShippingMethodyId(self.cart.shipping.shippingMethodId);
	      }
	
	      if ((!preselectedFromCart) && (!self.selectedShippingMethod)) {
	        preselectFromDefault();
	      }
      }   
      
      if (angular.isUndefined(self.selectedShippingMethod)) {
        selectShippingMethodyId(self.shippingMethods[0].id);
	selectShippingMethod(self.selectedShippingMethod);
      }else{
        selectShippingMethodyId(self.selectedShippingMethod.id);
        var hasSelected = false;
        var deliveryMethod;
        for (var i = 0; i < self.shippingMethods.length; i++) {
                if(self.shippingMethods[i].selected) hasSelected = true;
                if (self.shippingMethods[i].kind == 'delivery') deliveryMethod = self.shippingMethods[i];
        }
        if(!hasSelected) {
            
            self.selectedShippingMethod = {name : 'Delivery', description : 'Standard delivery', price : 0, kind : 'delivery', code : 3, id:'fake'};
        }
		
      }
      
      $rootScope.shippingPrice = self.selectedShippingMethod.price;
    }

    /**
     * Preselect store default
     */
    function preselectFromDefault() {
      for (var i = 0; i < self.shippingMethods.length; i++) {
        if (self.shippingMethods[i].isDefault) {
          self.shippingMethods[i].selected = true;
          self.selectedShippingMethod = self.shippingMethods[i];
        }
      }
    }

    /**
     * Put selected property by Id
     */
    function selectShippingMethodyId(id) {
      var selected = false;
      for (var i = 0; i < self.shippingMethods.length; i++) {
        if (self.shippingMethods[i].id === id) {
          self.shippingMethods[i].selected = true;
          self.selectedShippingMethod = self.shippingMethods[i];
          selected = true;
        } else {
          self.shippingMethods[i].selected = false;
        }
      }
      $timeout(function() {
        clearNoDirAddress();
      }, 50);
      
      return selected;
    }

    /**
     * sets the shipping method
     */
    function setShippingMethod(shippingData) {
      
      var deferred = $q.defer();
      
      setRestrictedShippingMethod().then(function(){
        
        var kindMethod = self.selectedShippingMethod.kind;
        if (kindMethod === 'itxdroppoint' || kindMethod === 'dropbox') {
          kindMethod = 'droppoint';
        }
        
        if (self.selectedShippingMethod.kind === 'definedDeliveryDate') {
          kindMethod = 'delivery';
        }

        var data = {
          kind : kindMethod,
          name : self.selectedShippingMethod.name,
          shippingData : shippingData,
          shippingMethodId : self.selectedShippingMethod.id
        };
        
        if(self.selectedShippingMethod.kind === 'definedDeliveryDate') {
          data.date = self.deliveryDate;
          data.idTimeRange = self.deliveryTimeRange;
        }
        
        if (self.selectedShippingMethod.kind === 'definedDeliveryDate') {
          data.date = self.deliveryDay;
          data.idTimeRange = self.deliveryHour;
        }

        inditex.execute({
          'actions' : [ {
            'action' : 'order:checkoutShipping',
            'params' : {
              'languageId' : inditex.iLangId,
              'storeId' : inditex.iStoreId,
              'orderId' : self.orderId
            },
            'data' : data
          } ],
          'onFinish' : function(status, response) {
            if (status === 1) {
            	inditex.iUserJSON.shopCart = response;
        		$rootScope.$emit('shopCartChanged');	
            	deferred.resolve(status);
            } else {
            	deferred.reject(response);
            }
          }
        });
        
      },
      function(data){
    	  deferred.reject(data);
      });
      
      return deferred.promise;
    }
    
    /**
     * In case restricted method we switch fake for the good one
     */
    function setRestrictedShippingMethod() {
      var deferred = $q.defer();
      
      if (inditex.iStoreJSON.details.postalCodeRestriction !== '0' && self.selectedShippingMethod.kind === 'delivery') {
        var address;

        if(self.sameBillingAddress === true){  
          if(self.sendToAnotherAddress){
           address = self.shippingAddress.address;
          }
          else{
            address = self.billingAddress.address;
          } 
        }
        else{
          address = self.shippingAddress.address;
        }

        itxShippingMethodsFactory.getShippingMethodsByZipCode(address.zipCode).then(function(response) {
         var hasMethods = false;	
          for (var i=0; i<response.length; i++) {
            if(response[i].kind === 'delivery') {
              hasMethods = true;
              self.selectedShippingMethod = response[i];
            }
          }
          if(hasMethods){
        	  deferred.resolve(); 
          }
          else{
        	  deferred.reject(inditex.text("noValidZipCode"));
          }
        });
      } else {
        deferred.resolve();
      }
      
      return deferred.promise;
    }

    /**
     * Gets the paymentMethod selection page URL
     */
    function getPaymentMethodUrl() {
      return inditex.encodeUrl({
        'action' : 'ItxOrderPaymentPage',
        'params' : {
          'storeId' : inditex.iStoreId,
          'langId' : inditex.iLangId,
          'catalogId' : inditex.iCatalogId
        },
        'isMobile' : false,
        'isAjax' : false
      });
    }
    
    /**
     * Gets the shippingMethod selection page URL
     */
    function getShippingMethodUrl() {
      return inditex.encodeUrl({
        'action' : 'ItxOrderShippingPage',
        'params' : {
          'storeId' : inditex.iStoreId,
          'langId' : inditex.iLangId,
          'catalogId' : inditex.iCatalogId
        },
        'isMobile' : false,
        'isAjax' : false
      });
    }
    
    /**
     * Clean addresses to avoid null values for undefined
     */
    function cleanAddressBook(addressBook) {
    	if (addressBook.addresses) {
	      for (var i = 0; i < addressBook.addresses.length; i++) {
	
	        cleanDefaultAddress(addressBook.addresses[i]);
	        
	        addressBook.addresses[i].invoice = undefined;
	        addressBook.addresses[i].addressType = undefined;
	        addressBook.addresses[i].preferredLanguage = undefined;
	        addressBook.addresses[i].isShippingAddress = undefined;
	        addressBook.addresses[i].isCompanyForDrop = undefined;
	        addressBook.addresses[i].checkUserExists = undefined;
	        addressBook.addresses[i].isFullAddress = undefined;
	        addressBook.addresses[i].dropType = undefined;
	        addressBook.addresses[i].birthdate = undefined;
	
	        addressBook.addresses[i].gender = 'F';
	
	        nullCheckAddressesProps(addressBook.addresses[i]);
	      }
    	}
    }
    
    function cleanDefaultAddress(address) {
      if (address.city === '-') {
        address.city = '';
      }
      
      if (address.zipCode === '-') {
        address.zipCode = '';
      }
      
      if (address.colony === '-') {
        address.colony = undefined;
      }
      
      if (address.lastName === '-') {
        address.lastName = undefined;
      }
      
      if (address.municipality === '-') {
        address.municipality = undefined;
      }
      
      if (address.phones && address.phones.length===1 && address.phones[0].countryCode === null) {
        address.phones[0].countryCode = self.phoneCountryCode;
      }
      
      if (address.phones && address.phones.length===1 && address.phones[0].subscriberNumber === '-') {
        address.phones[0].subscriberNumber = undefined;
      }
      
      if (address.addressLines && address.addressLines.length===1 && address.addressLines[0] === '-') {
        address.addressLines[0] = '';
      }
    }

    /**
     * Clean nulls (with undefined)
     */
    function nullCheckAddressesProps(address) {
      if (address.email === null) {
        address.email = undefined;
      }

      if (address.province === null) {
        address.province = undefined;
      }

      if (address.district === null) {
        address.district = undefined;
      }

      if (address.vatin === null) {
        address.vatin = undefined;
      }

      if (address.invoice === null) {
        address.invoice = undefined;
      }

      if (address.middleName === null) {
        address.middleName = undefined;
      }
    }
    
    function setBillingAddress(addressBook, states) {
      self.billingAddress.address = addressBook.addresses[0];
      if (inditex.iUserJSON.userType==='R') {
        self.billingAddress.address.email = inditex.iUserJSON.email;
      }
      
      if (self.billingAddress.address === undefined) {
        self.billingAddress.address = {};
        self.billingAddress.address.countryCode = self.countryCode;
        self.billingAddress.address.countryName = self.countryName;
        self.billingAddress.address.phones = [{countryCode:self.phoneCountryCode}];
        self.billingAddress.address.isCompany = false;
        self.billingAddress.address.company = null;
        self.billingAddress.address.gender = 'F';
        self.billingAddress.address.addressLines = [ '-' ];
        self.billingAddress.address.city = '-';
        self.billingAddress.address.addressName = '';
        self.billingAddress.address.zipCode = '-';
        self.billingAddress.address.vatin = '';
        self.billingAddress.address.stateCode = states[0].code;
        self.billingAddress.address.stateName = states[0].name;
        
      } else {
        self.billingZipCode = self.billingAddress.address.zipCode;
        self.billingAddresId = self.billingAddress.address.id;
        self.billingEmail = self.billingAddress.address.email;
      }
      
      if (self.billingAddress.address.stateCode === '-') {
        if (self.countryCode === 'GB') {
          self.billingAddress.address.stateCode = 'GBUKD';
          self.billingAddress.address.stateName = undefined;
        } else {
          self.billingAddress.address.stateCode = states[0].code;
          self.billingAddress.address.stateName = states[0].name;
        }
      }
      //guardamos los datos de compañía por defecto, si hay
      self.billingAddress.companyData = self.billingAddress.address.isCompany ? self.billingAddress.address.company : null;
      setupCreateBillingAddressData();
    }

      /**
      * Get Phone validation pattern by countryCode
      */
      function getPhoneValidation() {
        var regexp = gConstants.validations.phone[self.countryCode];
        return regexp;
      }    
    
      function unblockSaveButton(){
        self.blockSaveButton = false;
      }

      function blockSaveButton(){
        self.blockSaveButton = true;
      }

      function isSaveButtonBlocked(){
        return (  self.blockSaveButton );
      }

      function checkZipCodeRestriction(zipCode){
        return itxShippingMethodsFactory.isZipCodeRestricted(zipCode);
      }
    
      function hasToCheckRestrictedZipCodes(){
        return inditex.iStoreJSON.details.postalCodeRestriction == "1";
      }

      function getRestrictedZipCodeShippingMethods(zipCode){        
        itxShippingMethodsFactory.getShippingMethodsByZipCode(zipCode).then(loadShippingMethods);        
      }

      function loadShippingMethods(response){
    	self.hasDelivery = false;  
        self.deliveryAreaMessage = undefined;
        var validRestrictedShippingMethod = false;
        self.validDeliveryMethod = null;
    	var shippingMethods = [];
        for (var i=0; i < response.length; i++) {
		  if((inditex.iCountryCode != 'RU') || (response[i].id != 156902)){
			  if (inditex.iCountryCode == 'RU' && response[i].kind == 'pickup') shippingMethods.unshift(response[i]);
                          else shippingMethods.push(response[i]);
			  if(response[i].kind == 'delivery'){
				  self.hasDelivery = true;
                                  self.validDeliveryMethod = response[i];
			  }
		  }
                  
                  if (inditex.iCountryCode == 'RU' && self.selectedShippingMethod) {
                      if (response[i].id == self.selectedShippingMethod.id) validRestrictedShippingMethod = true;
                  }
        }
        //self.shippingMethods = shippingMethods;
        refreshShippingMethods(shippingMethods);
        if (inditex.iCountryCode == 'RU') {
            if (!self.hasDelivery) {
                var fakeShippingMethod = {name : 'Delivery', description : 'Standard delivery', price : 0, kind : 'delivery', code : 3, id:'fake'};
                shippingMethods.push(fakeShippingMethod);
                $timeout(function(){
                        $('#lightbox-rusia').parent().parent().parent().click(function(event){ 
                                event.preventDefault();
                                $(document).trigger('lightbox:open', ['#lbox-maparusia']);
                        });
                      $('#lightbox-rusia').parent().addClass('link-2');
                      $('#lightbox-rusia').addClass('link-2');
                });
            } else if (!validRestrictedShippingMethod && self.selectedShippingMethod) {
                self.shippingMethods = shippingMethods;
                if (self.selectedShippingMethod.kind == 'delivery') self.deliveryAreaMessage = inditex.text('ItxOrderShippingPage.noValidZipCodeForArea', self.validDeliveryMethod.name);
            }
        }
        
        preselectShippingMethod();
      }
      
      function refreshShippingMethods(shippingMethods){
    	  var shippingMethodsRefreshed = [];
    	  for (var i = 0; i < shippingMethods.length; i++) {
    		  if(self.shippingMethods){
	    		  for (var j = 0; j < self.shippingMethods.length; j++) {
	    			  if (shippingMethods[i].id === self.shippingMethods[j].id ) {
	    				  shippingMethods[i].selected = self.shippingMethods[j].selected; 
	    				  break;
	    			  }
	    			  shippingMethods[i].selected = false;
	    		  }
    		  }  
    		  shippingMethodsRefreshed.push(shippingMethods[i]);  
    	  }
    	  self.shippingMethods = shippingMethodsRefreshed;
      }
      
      function openRussiaMap() {
          $(document).trigger('lightbox:open', ['#lbox-maparusia']);
      }

      function performRestrictedZipCodeValidation(zipCode,addressType){
        checkZipCodeRestriction(zipCode).then(function(isRestricted){	
          if(isRestricted){
            blockSaveButton();
            //getRestrictedZipCodeShippingMethods(zipCode);
            $rootScope.$emit('address.'+addressType+'.zipcode.restricted.validation.fail');
            manageSetDeliveryAddressError({description:inditex.text('address.zipcode.restricted.validation.fail')});
          }
          else{
            unblockSaveButton();
            $rootScope.$emit('address.'+addressType+'.zipcode.restricted.validation.succeed');
            self.genericError = undefined;
            self.deliveryAreaMessage = undefined;
          }
        });
      }

      function clearNoDirAddress(){
        if($scope.shippingMethodsForm.contactData){
          $scope.shippingMethodsForm.$setPristine();
          $scope.shippingMethodsForm.$setUntouched();
          $scope.shippingMethodsForm.$submitted = false;
          //self.ngModel.$submitted = false;
          $scope.shippingMethodsForm.$valid = true;
        }
      }

      function getBillingAddressFullName() {
        return self.billingAddress.address.firstName + 
              (self.billingAddress.address.middleName != undefined ? ' ' + self.billingAddress.address.middleName + ' ' : ' ') + 
               self.billingAddress.address.lastName;
      }

      function getFullAddress() {
        var fullAddress = '';
        angular.forEach(self.billingAddress.address.addressLines, function(valor, index) {
           fullAddress += valor;
           if (index < self.billingAddress.address.addressLines.length-1) {
            fullAddress += ', ';
           }
        });
        return fullAddress;
      }

      function popUpAddressWindow(address){
          if (address && angular.element('#lbox-address-new' + address.id).length > 0) {
              $(document).trigger('lightbox:open', ['#lbox-address-new' + address.id]);
          } else {
              console.log('pop up ok');
              $(document).trigger('lightbox:open', ['#lbox-address-new']);
          }
      }

      function closeAddressWindow(status,response){
          $('.lbox').removeClass('md-show');
          $('#fade').fadeOut();
      }

      function editAddress(address) {
        $(document).trigger('GTM-push', ['popup-view-user', {
          'pageType': 'libro_direcciones',
              'pageTitle' : 'modificar',
              'section' : 'perfil_usuario'
          }]);
          popUpAddressWindow(address);
          setAddressToEdit(address);
          
      }

      function setAddressToEdit(address){
          var addressId = (address.id === undefined ? self.billingAddresId : address.id);

          self.addressToEdit = address;
          var scope = undefined;
          if (angular.element('#lbox-address-new' + addressId).length == 0 ) {
            scope = angular.element('#lbox-address-new').scope();
          } else {
            scope = angular.element('#lbox-address-new' + addressId).scope();
          }
          scope.formCtrl.addressToEdit = angular.copy(address);
      }

  }
}());


(function() {
  'use strict';

  angular.module('itxApp').directive('itxStoreSelection', itxStoreSelection);

  function itxStoreSelection() {

    var directive = {
      restrict : 'EAC',
      template : angular.element(document.querySelector('#tplStoreSelectionComponent')).html(),
      scope : {
        ngModel : '=',
        initialInput : '=',
        oneClickBuy : '=',
        addressesLoaded: '='
      },
      controller : itxStoreSelectionCtrl,
      controllerAs : 'itxStoreSelectionCtrl',
      bindToController : true
    };

    itxStoreSelectionCtrl.$inject = [ 'ItxPhysicalStoresFactory', '$q', '$rootScope', 'ItxModal' ];

    /**
     * Directive controller
     */
    function itxStoreSelectionCtrl(itxPhysicalStoresFactory, $q, $rootScope, ItxModal) {
      /* jshint validthis: true */
      var self = this;

      self.stores = undefined;
      self.getClosestStores = getClosestStores;

      self.newStoreSelection = false;
      self.loading = true;
      self.resetNewStoreSelection = resetNewStoreSelection;
      self.setStore = setStore;
      self.resetStoreSelection = resetStoreSelection;
      
      self.viewMap = viewMap;
      self.viewStoreInMap = viewStoreInMap;
      self.isEmployeeStore = isEmployeeStore;
      self.employeeStores = ["9934","9935","9936","9937","10194","10650","10674","10745","10753","10762","10771","10780","10797","11141"];


      if (!self.addressesLoaded) { //do not invoke 'init' until event $viewContentLoaded, so the user's addresses will be ready.
          $rootScope.$on('$userAddressesLoaded', function() {
            init(); 
          });
      } else init();
      
      
      $rootScope.$on('mapStoreSelection', setModelFromMap);
      
      function isEmployeeStore(store) {
          if (self.employeeStores.indexOf(store.id) >= 0) {  // 9934 es la tienda de solo empleados (arteixo)
            return true;
          } else {
            return false
          }
        }

      /**
       * Sets a store on ngModel using selectedStore
       */
      function setStore(store) {
          if (store !== undefined) {
            if (isEmployeeStore(store)) {
              ItxModal.open({
                  template: angular.element(document.querySelector('#tplEmployeeStoreModal')).html(),
                  controller: 'ItxModalController',
                  controllerAs: 'modal'
              }).then(function() {

              }, function() {

              });
            }
            self.ngModel.store = store;
            $rootScope.$emit('updateShippingMethod');
          }
        }
      
      /**
       * Reset the store selection from favourites
       */
      function resetStoreSelection() {
        init();
        self.newStoreSelection = false;
      }

      /**
       * Reset the store selection form (not favourites)
       */
      function resetNewStoreSelection() {
        self.ngModel.store = self.stores.closerStores[0];
        self.newStoreSelection = true;
      }

      /**
       * Obtain the closest stores to the input (or user geo-localization if
       * undefined)
       */
      function getClosestStores(zipCode) {

        var deferred = $q.defer();
        $rootScope.$emit('zipCodeChanged',zipCode);
        var longitude, latitude;
        if (zipCode) {
          itxPhysicalStoresFactory.getClosestStores(zipCode, longitude, latitude).then(function(stores) {
            self.stores = stores;
			$rootScope.$broadcast('addressComponent.address.form.reseted');
            if (self.stores.closerStores.length > 0) {
              self.ngModel.store = self.stores.closerStores[0];
            }
            else{
            	self.ngModel.store = null;
            }
            deferred.resolve(stores);
          });
        } else {
          getGeoLocation().then(function() {
        	if(self.initialInput == '' || self.initialInput == undefined){
        		longitude = inditex.iGeoLocationJSON['long'];
        		latitude = inditex.iGeoLocationJSON['lat'];
        	}

            itxPhysicalStoresFactory.getClosestStores(self.initialInput, longitude, latitude).then(function(stores) {
              self.stores = stores;
              deferred.resolve(stores);
            });
          });
        }

        return deferred.promise;
      }

      /**
       * get User GeoLocation
       */
      function getGeoLocation() {

        var deferred = $q.defer();

        if (angular.isDefined(inditex.iGeoLocationJSON)) {
          deferred.resolve();
        } else {
          inditex.execute({
            'actions' : [ {
              'action' : 'akamai:location',
              'params' : {
                'languageId' : inditex.iLangId,
                'storeId' : inditex.iStoreId,
                'catalogId' : inditex.iCatalogId
              }
            } ],
            'onFinish' : function(status) {
              if (status === 1) {
                deferred.resolve();
              } else {
                deferred.reject();
              }
            }
          });
        }
        
        return deferred.promise;
      }

      /**
       * Initialize the component
       */
      function init() {
    	$rootScope.$emit('$viewContentNotLoaded');
        if (angular.isUndefined(self.oneClickBuy)) {
          self.oneClickBuy = false;
        }
        
        /*if (self.initialInput === undefined || self.initialInput === '' || self.initialInput === '-') {
          self.initialInput = inditex.iStoreJSON.countryName;
        }*/

        getClosestStores(self.initialInput).then(function(stores) {
          self.loading=false;
          $rootScope.$emit('$viewContentLoaded');
          self.stores = stores;
          if (self.stores.favouriteStores.length === 0) {
            self.newStoreSelection = true;
            self.ngModel.store = self.stores.closerStores[0];

            if (self.stores.closerStores.length === 0 && self.initialInput) {
              self.initialInput = undefined;
              getClosestStores().then(function(storesForceGeo) {
                self.stores = storesForceGeo;
                if (self.stores.favouriteStores.length > 0) {
                  self.ngModel.store = self.stores.favouriteStores[0];
                } else {
                  self.ngModel.store = self.stores.closerStores[0];
                }
                $rootScope.$emit('updateShippingMethod');
              });
            } else {
            	$rootScope.$emit('updateShippingMethod');
            }

          } else {
            self.ngModel.store = self.stores.favouriteStores[0];
            $rootScope.$emit('updateShippingMethod');
          }
        });
      }
      
      /**
       * Sets only the map store (can be a store not showed previously)
       */
      function setModelFromMap() {
        setStore(self.ngModel.store);
        self.stores = {favouriteStores:self.stores.favouriteStores, closerStores : [self.ngModel.store]};
      }
      
      /**
       * Shows the map
       */
      function viewMap() {
        self.ngModel.showMap = true;
      }
      
      /**
       * Shows a store in the map
       */
      function viewStoreInMap(store) {
        self.ngModel.latitude = store.latitude;
        self.ngModel.longitude = store.longitude;
        self.ngModel.showMap = true;
      }

    }

    return directive;
  }

})();

angular.module("itxApp").decorator('itxStoreSelectionDirective', function itxStoreSelectionDirectiveDecorator($delegate){

	var directive = $delegate[1];
	
	 return( [ directive ] );
});

// END FIX_TIENDAZHOME-4276
</script><script type="text/javascript">
if (inditex.iCategoryKey !== undefined && inditex.iCategoryKey !== null && inditex.iCategoryKey.indexOf('_R_A_C_') > -1) {
  (function() {
    'use strict';

    angular.module('itxApp').filter('products', products);

    products.$inject = [ 'gConstants' ];

    function products(gConstants) {

      var genericTypeCategories = ['11','13', '14', '16', '18'];
      var inCategory11 = ['11','12'];
      var inCategory14 = ['14','15', '20'];
      var inCategory16 = ['16','17'];
      var inCategory18 = ['18','19'];
      var addedCategories = [];
      var concatDescriptions = [];
      /**
       * Filters a given productList returning based on filterValues parameter
       */
      function productsFilter(productList, filterValues, arraySizes) {
        var filtered = [];
        addedCategories = [];
        concatDescriptions = [];

        if (isFiltersSet(filterValues)) {

          /* INICIO FIX filtrado tallas: aniadimos filtrado por todas las categorias de cada grupo (90-105, 135-140 con 135 y 140, 150-160 con 150 y 160...etc) */
          /* INICIO BORRADO FILTRO */
          
          /* FIN BORRADO FILTRO */
          angular.forEach(filterValues.descriptions, function(filterValDesc, i) {
            angular.forEach(arraySizes, function(size, j) {
              if (filterValDesc.split(']]')[1].indexOf(size.description) > -1 && (genericTypeCategories.indexOf(size.mastersSizeId) || (inditex.iStoreJSON.iCountryCode !== 'DE' && size.mastersSizeId === 12) )) {
                addedCategories.push(size.mastersSizeId);
              }
            });
          });

          angular.forEach(addedCategories, function(addedCat, k) {
            angular.forEach(arraySizes, function(size, l) {
                if (concatDescriptions.indexOf(size.description) === -1) {
                  if (addedCat === '11' && inCategory11.indexOf(size.mastersSizeId) > -1) {
                    if (filterValues.descriptions.indexOf(size.description) === -1) {
                      concatDescriptions.push(size.description);
                    }
                  } else if (addedCat === '12' && inCategory11.indexOf(size.mastersSizeId) > -1) {
                    if (filterValues.descriptions.indexOf(size.description) === -1) {
                      concatDescriptions.push(size.description);
                    }
                  } else if (addedCat === '14' && inCategory14.indexOf(size.mastersSizeId) > -1) {
                    if (filterValues.descriptions.indexOf(size.description) === -1) {
                      concatDescriptions.push(size.description);
                    }
                  } else if (addedCat === '16' && inCategory16.indexOf(size.mastersSizeId) > -1) {
                    if (filterValues.descriptions.indexOf(size.description) === -1) {
                      concatDescriptions.push(size.description);
                    }
                  } else if (addedCat === '18' && inCategory18.indexOf(size.mastersSizeId) > -1) {
                    if (filterValues.descriptions.indexOf(size.description) === -1) {
                      concatDescriptions.push(size.description);
                    }
                  }
                }
                
              });
          });
          angular.forEach(concatDescriptions, function(desc, i){
            //var descS = '[[S]]' + desc;
            var desc = '[[E]]' + desc;
            if (filterValues.descriptions.indexOf(desc) === -1) {
              filterValues.descriptions.push(desc);
            }
          });
          
          /* FIN FIX filtrado tallas: aniadimos filtrado por todas las categorias de cada grupo (90-105, 135-140 con 135 y 140, 150-160 con 150 y 160...etc) */

          var selColors = objectToArray(filterValues.colors);
          var selFromPrice = filterValues.fromPrice.length === 0 ? 0
              : filterValues.fromPrice[0].value;
          var selToPrice = filterValues.toPrice.length === 0 ? 999999999
              : filterValues.toPrice[0].value;
          var selAttributes = objectToArray(filterValues.attributes);
          for (var i = 0; i < productList.length; i++) {

            if (passColorFilter(productList[i], selColors) &&
                passPriceFilter(productList[i], selFromPrice, selToPrice) &&
                passAttrFilter(productList[i], selAttributes) &&
                passSizeFilter(productList[i], filterValues.sizes) &&
                passDescriptionFilter(productList[i], filterValues.descriptions)) {
              filtered.push(productList[i]);
            }
          }
        } else {
          filtered = productList;
        }

        return filtered;
      }

      function isFiltersSet(filterValues) {
        var set = false;

        if(filterValues.colors.length > 0 ||
            filterValues.attributes.length > 0 ||
            filterValues.sizes.length > 0 ||
            filterValues.descriptions.length > 0) {
          set = true;
        } else if(filterValues.fromPrice.length > 0 ||
            filterValues.toPrice.length > 0) {
          set = true;
        }

        return set;
      }

     /**
      * Put all values in filter object array into an array of strings
      */
      function objectToArray(objectArr) {
        var strArr = [];

        if (objectArr != null) {
          for (var i = 0; i < objectArr.length; i++) {
            strArr.push(objectArr[i].value);
          }
        }
        return strArr;
      }

      /**
       * Color filter validation
       */
      function passColorFilter(product, colors) {

        if (colors.length === 0) {
          return true;
        }

        for (var i = 0; i < product.attributes.length; i++) {
          if (product.attributes[i].type === gConstants.TIPO_FILTRO_COLOR &&
              colors.indexOf(product.attributes[i].name) >= 0) {
            return true;
          }
        }

        return false;
      }

      /**
       * Price filter validation
       */
      function passPriceFilter(product, fromPrice, toPrice) {
        var pass = false;

        fromPrice = parseInt(fromPrice);
        toPrice = parseInt(toPrice);

        if (product.type === gConstants.BUNDLE) {
          for (var i = 0; i < product.bundleProductSummaries.length; i++) {
            pass = pass || passPriceFilter(product.bundleProductSummaries[i], fromPrice, toPrice);
          }
        } else if (product.type === gConstants.PRODUCT) {
          var auxPrices = getProdPrices(product);
          pass = isBetween(auxPrices, fromPrice, toPrice);
        }

        return pass;
      }

      /**
       * Return the array of prices of one product
       */
      function getProdPrices(product) {
        var prices = [];

        for (var i = 0; i < product.detail.colors.length; i++) {
          for (var j = 0; j < product.detail.colors[i].sizes.length; j++) {
            prices.push(product.detail.colors[i].sizes[j].price);
          }
        }

        return prices;
      }

      /**
       * Returns true if any of the values of the array is between
       * fromValue and toValue both included
       */
      function isBetween(values, fromValue, toValue) {
        var isBet = false;

        for(var i=0; i<values.length; i++) {
          if(values[i]>=fromValue && values[i]<=toValue) {
            return true;
          }
        }

        return isBet;
      }

      /**
       * Attr filter validation
       */
      function passAttrFilter(product, attributes) {
        if (attributes.length === 0) {
          return true;
        }

        if (product.type === gConstants.PRODUCT) {
          for (var i = 0; i < product.attributes.length; i++) {
            if (product.attributes[i].type === gConstants.TIPO_FILTRO_CARACTERISTICAS &&
              attributes.indexOf(product.attributes[i].name)>=0) {
              return true;
            }
          }
        } else if (product.type === gConstants.BUNDLE) {
          for (var i = 0; i < product.bundleProductSummaries.length; i++) {
            var attrs = product.bundleProductSummaries[i].attributes;
            for (var j = 0; j < attrs.length; j++) {
              if (attrs[j].type === gConstants.TIPO_FILTRO_CARACTERISTICAS &&
                attributes.indexOf(attrs[j].name)>=0) {
                return true;
              }
            }
          }
        }

        return false;
      }

      /**
       * Size filter validation
       */
      function passSizeFilter(product, sizes) {
        var pass = false;

        if (sizes != null && sizes.length > 0) {
          if (product.type === gConstants.BUNDLE) {
            for (var i = 0; i < product.bundleProductSummaries.length; i++) {
              pass = pass || passSizeFilter(product.bundleProductSummaries[i], sizes);
            }
          } else if (product.type === gConstants.PRODUCT) {
            var auxSizes = getProdSizes(product);

            pass = isIn(sizes, auxSizes);
          }
        } else {
          pass = true;
        }

        return pass;
      }

      /**
       * Description filter validation
       */
      function passDescriptionFilter(product, descriptions) {
        var pass = false;

        if (descriptions != null && descriptions.length > 0) {
          if (product.type === gConstants.BUNDLE) {
            for (var i = 0; i < product.bundleProductSummaries.length; i++) {
              pass = pass || passDescriptionFilter(product.bundleProductSummaries[i], descriptions);
            }
          } else if (product.type === gConstants.PRODUCT) {
            var auxDescriptions = getProdDescriptions(product);

            pass = isIn(descriptions, auxDescriptions);
          }
        } else {
          pass = true;
        }

        return pass;
      }

      return productsFilter;
    }

    function isIn(value, values) {
      var truth = false;

      for (var j=0; j<values.length; j++) {
        if(value.indexOf(values[j]) >= 0) {
          truth = true;
          break;
        }
      }

      return truth;
    }

    /**
     * Return the array of sizes of one product
     */
    function getProdSizes(product) {
      var sizes = [];

      for (var i = 0; i < product.detail.colors.length; i++) {
        for (var j = 0; j < product.detail.colors[i].sizes.length; j++) {
          sizes.push(product.detail.colors[i].sizes[j].name);
        }
      }

      return sizes;
    }

    /**
     * Return the array of sizes of one product
     */
    function getProdDescriptions(product) {
      var descriptions = [];

      for (var i = 0; i < product.detail.colors.length; i++) {
        for (var j = 0; j < product.detail.colors[i].sizes.length; j++) {
          var description = product.detail.colors[i].sizes[j].description;
          var size = product.detail.colors[i].sizes[j].name;

          if (description) {
            descriptions.push('[[E]]' + description);
          }

          if (size) {
            descriptions.push('[[S]]' + size);
          }
        }
      }

      return descriptions;
    }
  })();
}
</script><script type="text/javascript">
// FIX_TIENDAZHOME-4278

(function () {
	function _initGoogleMaps (self, callback, isAutocomplete) {
		var head;
		var script;
		var done = false;
		var url = "https://www.google.com/jsapi";
		var params = "";
		var patt =  new RegExp(inditex.iGoogleMapsRegexPublic);
		
		/* Si está activo llamamos al callback*/
		if(window.google && window.google.maps) {
			if (typeof callback === "function") {
    			callback();
    		}
		} else {
			if (patt.test(inditex.iPage)){
				if (self.iGoogleMapsKey){
					params += "key=" + self.iGoogleMapsKey;
				}
			} else {
				if (self.iGoogleMapsUser){
					var clientId = self.iGoogleMapsUser;
					if (isAutocomplete) {
						clientId = "gme-inditex1";
					}
					params += "client=" + clientId +
					"&channel=" + self.iGoogleMapsChannel;
				}
			}
						
			if (inditex.iGooglePlacesEnabled) params += "&libraries=places";
			script = document.createElement("script");
			script.src = url;
			script.type = "text/javascript";
			script.onload = script.onreadystatechange = function() {
			    if (!done) {
				    if (!this.readyState || 
				    		this.readyState === "loaded" || 
				    		this.readyState === "complete") {
				    	
				    	done = true;
				        script.onload = script.onreadystatechange = null;
				        if (head && script.parentNode) {
				            head.removeChild(script);
				        }
				        
				        google.load("maps", "3", {
							other_params: params,
							callback: function () {
				        		if (typeof callback === "function") {
				        			callback();
				        		}
							}
						});
				    }
				}
			};
			
			head = document.getElementsByTagName("head")[0] || document.documentElement;
			if(!(head.children[0].src && (head.children[0].src.indexOf("google.com/jsapi") > -1))) {
				head.insertBefore(script, head.firstChild);
			}
		}
		
		
	};
	/**
	 * Este método permite obtener la ruta a la imagen para las marcas en el mapa
	 * @function getGoogleMapsMarkerUrl
	 * @return {string} Ruta a la imagen
	 * @param {boolean} on - True indica imagen para marca activa, False imagen para marca inactiva
	 * @example inditex.getGoogleMapsMarkerUrl(true);
	 */
	inditex.getGoogleMapsMarkerUrl = function (on) {
		var self = this;
		var result;
		
		if (window.location.protocol == 'https:') {
			result = self.iStoreJSON.details.staticUrl.replace("http:", "https:");
		} else {
			result = self.iStoreJSON.details.staticUrl.replace("https:", "http:");
		}
		
		result += result[result.length -1] == '/' ? '' : '/';
		result += self.iLayout;
		result += "/images/google_maps_marker_";
		
		if (on) {
			result += "on";
		} else {
			result += "off";
		}
		
		result += ".png";
		
		return result;
	};
	
	/**
	 * Este método permite obtener la ruta a la imagen para las marcas en el mapa
	 * @function getGoogleMapsMarkerUrlAlt
	 * @return {string} Ruta a la imagen
	 * @param {boolean} on - True indica imagen para marca activa, False imagen para marca inactiva
	 * @param {string} icon - Nombre de la imagen
	 * @example inditex.getGoogleMapsMarkerUrl(true, "marker");
	 */
	inditex.getGoogleMapsMarkerUrlAlt = function(on, icon) {
		var self = this;
		var result;
		
		if (window.location.protocol == 'https:') {
			result = self.iStoreJSON.details.staticUrl.replace("http:", "https:");
		} else {
			result = self.iStoreJSON.details.staticUrl.replace("https:", "http:");
		}
		
		result += result[result.length -1] == '/' ? '' : '/';
		result += self.iLayout;
		result += "/images/";
		result += icon;
		result += "_";
		
		if (on) {
			result += "on";
		} else {
			result += "off";
		}
		
		result += ".png";
		
		return result;
	};
		
	
	/**
	 * @typedef {function} initGoogleMapsCallbackAddMarkSuccess
	 * @param {number} index - Posición de la marca
	 */
	
	/**
	 * @typedef {function} initGoogleMapsCallbackAddMark
	 * @param {number} index - Posición de la marca.
	 * @param {number} latitude - Latitud
	 * @param {number} longitude - Longitud
	 * @param {string} text - Texto
	 * @param {initGoogleMapsCallbackAddMarkSuccess} success - Callback que se invoca cuando se termina de añadir la marca
	 */
	
	/**
	 * @typedef {function} initGoogleMapsCallbackFocusMark
	 * @param {number} index - Posición de la marca.
	 */
	
	/**
	 * @callback initGoogleMapsCallback
	 * @param {object} obj  - Objeto que permite manipular el mapa
	 * @param {object} obj[].iMap - Referencia al objeto mapa en el API de google maps
	 * @param {initGoogleMapsCallbackAddMark}  obj[].addMark - Método que permite añadir una marca al mapa
	 * @param {initGoogleMapsCallbackFocusMark}  obj[].focusMark - Método que permite centrar el mapa en una marca
	 * @param {function} clear - Método que elimina todas las marcas del mapa
	 * @param {function} focus - Método que centra el mapa para que se vean todas las marcas. 
	 */
	
	/**
	 * Este método inicializa un mapa de google maps.
	 * @function initGoogleMaps
	 * @return (void)
	 * @param {string} aContainer - Identificador del elemento del DOM donde se inicializará el mapa
	 * @param {string} aCountry - Código ISO del país
	 * @param {string} aAddress - Dirección en la que centrar el mapa.
	 * @param {initGoogleMapsCallback} aCallback - Callback que se ejecuta cuando el mapa termina de inicializarse
	 * @param {string} [aCustomIcon] - Nombre de icono de marca personalizado
	 * @example inditex.initGoogleMaps("iMapContainer", "ES", "lugo", function(map) {
	 *	map.addMark(1, 4.5, 5.6, "Texto");
	 *	map.addMark(2, 2.4, 3.7, "Texto");
	 *	map.focus();	
	 *}, "marker");
	 */
	inditex.initGoogleMaps = function (aContainer, aCountry, aAddress, aCallback, aCustomIcon) {
		var self = this;
		
		self.getGoogleCoords(aCountry, aAddress, function (aResult) {
			var map = {
				iMap: new google.maps.Map(document.getElementById(aContainer), {
					zoom: 5,
					center: aResult ? aResult.geometry.location : new google.maps.LatLng(0, 0),
					mapTypeId: google.maps.MapTypeId.ROADMAP
				}),
					
				iMarkers: [],
				iWindows: [],
					
				addMark: function (index, latitude, longitude, text, onSuccess) {
					var self = this;
					
					if ((aCustomIcon == undefined || aCustomIcon == true)){
						self.iMarkers[index] = new google.maps.Marker({
							position: new google.maps.LatLng(latitude, longitude),
							map: self.iMap,
							icon: inditex.getGoogleMapsMarkerUrl(false)
						});
					} else {
						if (aCustomIcon == false) {
							self.iMarkers[index] = new google.maps.Marker({
								position: new google.maps.LatLng(latitude, longitude),
								map: self.iMap
							});
						} else if (typeof aCustomIcon == "string") {
							self.iMarkers[index] = new google.maps.Marker({
								position: new google.maps.LatLng(latitude, longitude),
								map: self.iMap,
								icon: inditex.getGoogleMapsMarkerUrlAlt(false, aCustomIcon)
							});
						}
					}
						
					self.iWindows[index] = new google.maps.InfoWindow({
						content: text
					});
						
					google.maps.event.addListener(self.iMarkers[index], 'click', function(e) {
						self.focusMark(index);
						if (onSuccess) {
							onSuccess(index);
						}
					});
				},
					
				focusMark: function(index) {
					var self = this;
						
					for (var i = 0; i < self.iMarkers.length; i++) {
						if (i == index) {
							self.iWindows[i].open(self.iMap, self.iMarkers[i]);
							if (!self.iMap.getBounds().contains(self.iMarkers[i].getPosition())) {
								self.iMap.panTo(self.iMarkers[i].getPosition());
							}
							if (aCustomIcon == undefined || aCustomIcon == true) {
								self.iMarkers[i].setIcon(inditex.getGoogleMapsMarkerUrl(true));
							}
							else if (typeof aCustomIcon == "string") {
								self.iMarkers[i].setIcon(inditex.getGoogleMapsMarkerUrlAlt(true, aCustomIcon));
							}
						} else {
							self.iWindows[i].close();
							if (aCustomIcon == undefined || aCustomIcon == true) {
								self.iMarkers[i].setIcon(inditex.getGoogleMapsMarkerUrl(false));
							}
							else if (typeof aCustomIcon == "string") {
								self.iMarkers[i].setIcon(inditex.getGoogleMapsMarkerUrlAlt(false, aCustomIcon));
							}
						}
					}
				},
				clear: function() {
					var self = this;
						
					for (var i = 0; i < self.iMarkers.length; i++) {
						self.iMarkers[i].setMap(null);
						self.iWindows[i].close();
					}
					self.iMarkers.length = 0;
					self.iWindows.length = 0;
				},
				focus: function() {
					var self = this;
						
					var bounds = new google.maps.LatLngBounds();
						
					for (var i = 0; i < self.iMarkers.length; i++) {
						bounds.extend(self.iMarkers[i].getPosition());
					}
						
					self.iMap.fitBounds(bounds);
					if(self.iMap.getZoom() > 17) {
						self.iMap.setZoom(17);
					}
				}
			}
				
			aCallback(map);
		});
	};
		
	/**
	 * @callback getGoogleCoordsCallback - Callback que se llama cuando se han recuperado las coordenadas
	 * @param {object} result - Objeto resultado retornado por el API de google maps
	 */


	/**
	 * Este método permite consultar con el API de google maps las coordenadas de una dirección
	 * @function getGoogleCoords
	 * @return (void)
	 * @param {string} aCountry - Código ISO del país
	 * @param {string} aAddress - Dirección a buscar
	 * @param {getGoogleCoordsCallback} aCallback - Callback que se llama cuando se han recuperado las coordenadas
	 * @example inditex.getGoogleCoords("ES", "lugo", function(result) {})
	 */
	inditex.getGoogleCoords = function(aCountry, aAddress, aCallback) {
		var self = this;
			
		_initGoogleMaps(self, function() {
			var tokens = aCountry.split("_");
			var country = tokens[0];
			var address = aAddress;
		
			if ((country == "ES") && (aAddress == "ES")) {
				address = "Spain";
			}
				
			if (country == "ESCN" || country == "IC") {
				country = "ES";
				if(aAddress == "IC"){
					address = "Canarias";
				}
			}
				
			var region = null;
			if (tokens.length > 1) {
				region = tokens[1];
			}
				
			var geocoder = new google.maps.Geocoder();
			geocoder.geocode({address: address,componentRestrictions:{ country: country }}, function(results, status) {
				var result = null;
				
				if(status = google.maps.GeocoderStatus.OK) {
					for(var i = 0; i < results.length && result == null; i++){
						var components = results[i].address_components;
								
						var equalsCountry = false;
						var equalsRegion = region ? false : true;
								
						for(var j = components.length - 1; j >= 0; j--) {
							var component = components[j];
									
							if(!country || (component.types[0] == 'country' && component.types[1] == 'political' && component.short_name == country)) {
								equalsCountry = true;
							}
									
							if((component.types[0]=='administrative_area_level_1' && component.types[1]=='political' && component.short_name == region)) {
								equalsRegion = true;
							}
									
							if(equalsCountry && equalsRegion){
								result = results[i];
								break;
							}
						}
					}
				}
				
				aCallback(result);
			});
		});
	};
	
	
	/**
	 * Este método permite cargar el JS de autocompletado de direcciones de Google
	 * @function loadGoogleAutocompleteAddress
	 * @return (void)
	 * @param {function} aCallback - Callback que se llama cuando se ha cargado el JS de autocompletado de Google
	 * @example inditex.loadGoogleAutocompleteAddress(function(){})
	 */
	inditex.loadGoogleAutocompleteAddress = function(aCallback){
		var self = this;
		
		if (inditex.iGooglePlacesEnabled){		
			_initGoogleMaps(self, function() {
				if (typeof aCallback === "function") {
					aCallback();
	    		}
			}, true);
		}
	};
	
})();

// END FIX_TIENDAZHOME-4278
</script><script id="tplProductComponentGrid" type="text/itx-template">
  <div class="img-wrap">
    <a id="img_product_{{product.id}}" product-reference="{{product.detail.reference}}" ng-mousedown="selectProduct(product, getProductUrl(product), $event)">
        <img ng-src="/static/itxwebstandard/images/placeholderImage.jpg?t=20160727175509db" place-holder-src="{{ ::getProductImageByUse(product, template) }}" alt="{{ ::product.name }}" />
    </a>

    <span class="colores" ng-if="::(product.type === 'BundleBean')">
        <a ng-repeat="relatedBundle in ::product.colorRelatedBundles | limitTo:6" ng-href="{{ ::getProductUrl(relatedBundle.id) }}" ng-click="$event.preventDefault(); changeColor(relatedBundle)">
          <img ng-src="{{ ::getProductImage(relatedBundle.image, 3, '5') }}">
        </a>
    </span>
    <span class="colores" ng-if="::(product.type !== 'BundleBean')">
        <a ng-repeat="(colorId, colorObject) in ::productColors | ifGreaterThan:1" ng-href="{{ ::getProductUrl(product) }}" ng-click="$event.preventDefault(); changeColor(product, colorObject)">
          <img ng-src="{{ ::getProductImage(colorObject.image, 3, '5') }}">
        </a>
    </span>

    <a class="bundle-btn" ng-if="::(product.type === 'BundleBean' && (product.bundleProductSummaries.length > 1))"
       ng-click="openQuicklook('quicklookBundleRequest', product, $event)">QUICKLOOK
    </a>
    <a class="quicklook-btn" ng-if="::(product.type === 'ProductBean')"
       ng-click="openQuicklook('quicklookProductRequest', product, $event)">QUICKLOOK
    </a>
    <a class="quicklook-btn" ng-if="::(product.type === 'BundleBean' && (product.bundleProductSummaries.length == 1))"
       ng-click="openQuicklook('quicklookProductRequest', product, $event)">QUICKLOOK
    </a>

    <!--<a class="like" ng-if="product.type !== 'BundleBean'" ng-click="$emit('addToWishlist', product.id)"></a>-->
  </div>
  <div>
    <h2>
      <a ng-mousedown="selectProduct(product, getProductUrl(product), $event)">
        {{ ::product.name }}
      </a>
    </h2>
    <span ng-if="::addToCartVisible">

      <!-- Precio Rebajado -->
      <span ng-if="::(!priceRanges.priceNotAvailable && oldAndCurrentPricesAreDifferent && priceRanges.someOldPricesWereDefined)">

        <p class="rebajado">
          <span ng-bind-html='::formatPriceRange(priceRanges.current)'/>
        </p>

        <p class="tachado">
          <span ng-bind-html='::formatPriceRange(priceRanges.old)'/>
        </p>

        <!--<p class="info-highlight"><span>REBAJADO</span></p>-->


      </span>

      <!-- Precio Normal, no rebajado -->
      <span ng-if="::(priceRanges.priceNotAvailable || !oldAndCurrentPricesAreDifferent || !priceRanges.someOldPricesWereDefined)">

        <p ng-if="::priceRanges.priceNotAvailable">Precio no disponible</p>
        <p ng-if="::!priceRanges.priceNotAvailable"><span ng-bind-html='::formatPriceRange(priceRanges.current)'/></p>

        <!-- <p class="info-highlight"><span>NUEVO</span></p> -->
      </span>

      <span ng-if="::hasMoreThanOneColor" class="mas-colores">+ COLORES</span>

      <img ng-repeat="labelUrl in ::labelAttachments track by $index" ng-src="{{ ::labelUrl }}">
    </span>
  </div>
</script>
<script type="text/javascript">
(function() {

    inditex.onReady(function() {
        var show = inditex.iStoreJSON.details.visibleBookings === 'SHOW' || (inditex.iStoreJSON.details.visibleBookings === 'HIDDEN' && !inditex.iUserJSON.restrictedBooking);
        if (!show) {
            var styles = 'ul.fav-loc-bar .stock-btn, #bookings-menu-option, #mi-cuenta-reservas { display: none; }';
            $("<style>").text(styles).appendTo("head");
		}
    });

})();
</script>
<!-- END SPOT=ZH3_ESpot_Inditex -->

<link rel="stylesheet" type="text/css" href="https://static.zarahome.net/8/static3/itxwebstandard/css/itx-custom-main.min.css?t=20160730041000" />

<!-- BEGIN SPOT=ZH3_ESpot_HeadEnd -->
<script>
(function(){
  if (window.BOOMR && window.BOOMR.version) { return; }
  var dom,doc,where,iframe = document.createElement("iframe"),win = window;

  function boomerangSaveLoadTime(e) {
    win.BOOMR_onload=(e && e.timeStamp) || new Date().getTime();
  }
  if (win.addEventListener) {
    win.addEventListener("load", boomerangSaveLoadTime, false);
  } else if (win.attachEvent) {
    win.attachEvent("onload", boomerangSaveLoadTime);
  }

  iframe.src = "javascript:void(0)";
  iframe.title = ""; iframe.role = "presentation";
  (iframe.frameElement || iframe).style.cssText = "width:0;height:0;border:0;display:none;";
  where = document.getElementsByTagName("script")[0];
  where.parentNode.insertBefore(iframe, where);

  try {
    doc = iframe.contentWindow.document;
  } catch(e) {
    dom = document.domain;
    iframe.src="javascript:var d=document.open();d.domain='"+dom+"';void(0);";
    doc = iframe.contentWindow.document;
  }
  doc.open()._l = function() {
    var js = this.createElement("script");
    if (dom) { this.domain = dom; }
    js.id = "boomr-if-as";
    js.src = "//c.go-mpulse.net/boomerang/" +
    "UE749-ZXPWB-C7DGP-SHNZE-LABAA";
    BOOMR_lstart=new Date().getTime();
    this.body.appendChild(js);
  };
  doc.write('<body onload="document._l();">');
  doc.close();
})();
</script>
<!-- END SPOT=ZH3_ESpot_HeadEnd -->

<!-- END post-common head -->
	</head>	
	
	
<!-- BEGIN SPOT=ZH3_ESpot_WorldWide -->
<style>.worldwide-background {	background-image: url(http://static.zarahome.net/8/static3/itxwebstandard/images/Worldwide/worldwide.jpg?20160730041000);	background-color: #fff;	background-position: top center;	background-repeat: no-repeat;	background-size: 100% auto;}</style>
<!-- END SPOT=ZH3_ESpot_WorldWide -->
	
	
	<body id="countriesSel" class="worldwide-background" data-ng-controller="ItxWorldWidePageCtrl as ItxWorldWidePage">
<!-- BEGIN SPOT=ZH3_ESpot_BodyBegin -->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-598MKV"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-598MKV');</script>
<!-- End Google Tag Manager -->
<!-- END SPOT=ZH3_ESpot_BodyBegin -->

<phone-purchase-agent></phone-purchase-agent>
<phone-purchase-blocked></phone-purchase-blocked>

<!-- Google Adwords -->
<!-- BEGIN SPOT=ZH3_ESpot_Conversion_Adwords -->

<!-- END SPOT=ZH3_ESpot_Conversion_Adwords -->
<!-- End Google Adwords -
->
<!-- Hello Media -->
<!-- BEGIN SPOT=ZH3_ESpot_HelloMedia -->

<!-- END SPOT=ZH3_ESpot_HelloMedia -->
<!-- End Hello Media -->            <main class="countriesContainer container-fluid" ng-cloak>
                <section class="logo">
                    <img src="/static/itxwebstandard/images/ic_logo.svg?t=20160727175509db" width="227" height="14" alt="">
                    <span class="fraseLogo">{{ ItxWorldWidePage.getMessage("title") }}</span>
						<div ng-if="ItxWorldWidePage.showH1">
						    <h1>WorldWide - Zara Home</h1>
						</div>
                </section>
                <section class="countriesLists row hidden-xs">
                    <div class="col-sm-4">
                        <article class="col-md-6" ng-if="ItxWorldWidePage.getStoresByContinent('2').length > 0">
                            <span class="continentTitle">America</span>
                            <ul class="continent">
                                <li id="{{iStore.countryName}}" ng-class="iStore.isOpenForSale ? 'basket' : ''" data-ng-repeat="iStore in ItxWorldWidePage.getStoresByContinent('2') | orderBy : ['countryName']" ng-click="ItxWorldWidePage.selectRegion(iStore)">{{iStore.countryName}}
                                    <div class="langPanel hide">
                                        <div ng-class="iStore.isOpenForSale ? 'langPanelTitle' : 'langPanelTitleNotOnline'">{{iStore.countryName}}</div>
                                        <ul class="langList">
                                            <li id="{{iStore.countryName}}_{{iLanguage.name}}" data-ng-repeat="iLanguage in iStore.supportedLanguages"><a ng-href="{{ItxWorldWidePage.getStoreUrl(iStore,iLanguage.id)}}" ng-click="ItxWorldWidePage.selectLang(iLanguage, $event)">{{iLanguage.name}}</a></li>
                                        </ul>
                                    </div>
                                    <img ng-if="iStore.isNew" src="/static/itxwebstandard/images/ico-new.png?t=20160727175509db" alt="">
                                </li>
                            </ul>
                        </article>
                        <article class="col-md-6" ng-if="ItxWorldWidePage.getStoresByContinent('5').length > 0">
                            <span class="continentTitle">Middle East</span>
                            <ul class="continent">
                                <li id="{{iStore.countryName}}" ng-class="iStore.isOpenForSale ? 'basket' : ''" data-ng-repeat="iStore in ItxWorldWidePage.getStoresByContinent('5') | orderBy : ['countryName']" ng-click="ItxWorldWidePage.selectRegion(iStore)">{{iStore.countryName}}
                                    <div class="langPanel hide">
                                        <div ng-class="iStore.isOpenForSale ? 'langPanelTitle' : 'langPanelTitleNotOnline'">{{iStore.countryName}}</div>                                    <ul class="langList">
                                            <li id="{{iStore.countryName}}_{{iLanguage.name}}" data-ng-repeat="iLanguage in iStore.supportedLanguages"><a ng-href="{{ItxWorldWidePage.getStoreUrl(iStore,iLanguage.id)}}" ng-click="ItxWorldWidePage.selectLang(iLanguage, $event)">{{iLanguage.name}}</a></li>
                                        </ul>
                                    </div>
                                    <img ng-if="iStore.isNew" src="/static/itxwebstandard/images/ico-new.png?t=20160727175509db" alt="">
                                </li>
                            </ul>
                        </article>
                    </div>
                    <div class="col-sm-8">
                        <article class="col-md-6 clearfix" ng-if="ItxWorldWidePage.getStoresByContinent('4').length > 0">
                            <span class="continentTitle">Europe</span>                            
                            <ul class="europeList floatLeft">
                                <li id="{{iStore.countryName}}" ng-class="iStore.isOpenForSale ? 'basket' : ''" data-ng-repeat="iStore in ItxWorldWidePage.getStoresByContinent('4') | orderBy : ['countryName']" ng-click="ItxWorldWidePage.selectRegion(iStore)">{{iStore.countryName}}
                                    <div class="langPanel hide">
                                        <div ng-class="iStore.isOpenForSale ? 'langPanelTitle' : 'langPanelTitleNotOnline'">{{iStore.countryName}}</div>                                    <ul class="langList">
                                        <ul class="langList">
                                            <li id="{{iStore.countryName}}_{{iLanguage.name}}" data-ng-repeat="iLanguage in iStore.supportedLanguages"><a ng-href="{{ItxWorldWidePage.getStoreUrl(iStore,iLanguage.id)}}" ng-click="ItxWorldWidePage.selectLang(iLanguage, $event)">{{iLanguage.name}}</a></li>
                                        </ul>
                                    </div>
                                    <img ng-if="iStore.isNew" src="/static/itxwebstandard/images/ico-new.png?t=20160727175509db" alt="">
                                </li>
                            </ul>                            
                        </article>
                        <article class="col-sm-6 col-md-3">
                            <div ng-if="ItxWorldWidePage.getStoresByContinent('1').length > 0">
                            <span class="continentTitle">Africa</span>
                            <ul class="continent">
                                <li id="{{iStore.countryName}}" ng-class="iStore.isOpenForSale ? 'basket' : ''" data-ng-repeat="iStore in ItxWorldWidePage.getStoresByContinent('1') | orderBy : ['countryName']" ng-click="ItxWorldWidePage.selectRegion(iStore)">{{iStore.countryName}}
                                    <div class="langPanel hide">
                                        <div ng-class="iStore.isOpenForSale ? 'langPanelTitle' : 'langPanelTitleNotOnline'">{{iStore.countryName}}</div>                                    <ul class="langList">
                                        <ul class="langList">
                                            <li id="{{iStore.countryName}}_{{iLanguage.name}}" data-ng-repeat="iLanguage in iStore.supportedLanguages"><a ng-href="{{ItxWorldWidePage.getStoreUrl(iStore,iLanguage.id)}}" ng-click="ItxWorldWidePage.selectLang(iLanguage, $event)">{{iLanguage.name}}</a></li>
                                        </ul>
                                    </div>
                                    <img ng-if="iStore.isNew" src="/static/itxwebstandard/images/ico-new.png?t=20160727175509db" alt="">
                                </li>
                            </ul>
                            </div>
                            <div ng-if="ItxWorldWidePage.getStoresByContinent('6').length > 0">
                            <span class="continentTitle">Oceanía</span>
                            <ul class="continent">
                                <li id="{{iStore.countryName}}" ng-class="iStore.isOpenForSale ? 'basket' : ''" data-ng-repeat="iStore in ItxWorldWidePage.getStoresByContinent('6') | orderBy : ['countryName']" ng-click="ItxWorldWidePage.selectRegion(iStore)">{{iStore.countryName}}
                                    <div class="langPanel hide">
                                        <div ng-class="iStore.isOpenForSale ? 'langPanelTitle' : 'langPanelTitleNotOnline'">{{iStore.countryName}}</div>                                    <ul class="langList">
                                        <ul class="langList">
                                            <li id="{{iStore.countryName}}_{{iLanguage.name}}" data-ng-repeat="iLanguage in iStore.supportedLanguages"><a ng-href="{{ItxWorldWidePage.getStoreUrl(iStore,iLanguage.id)}}" ng-click="ItxWorldWidePage.selectLang(iLanguage, $event)">{{iLanguage.name}}</a></li>
                                        </ul>
                                    </div>
                                    <img ng-if="iStore.isNew" src="/static/itxwebstandard/images/ico-new.png?t=20160727175509db" alt="">
                                </li>
                            </ul>
                            </div>
                        </article>
                        <article class="col-sm-6 col-md-3" ng-if="ItxWorldWidePage.getStoresByContinent('3').length > 0">
                            <span class="continentTitle">Asia</span>
                            <ul class="continent">
                                <li id="{{iStore.countryName}}" ng-class="iStore.isOpenForSale ? 'basket' : ''" data-ng-repeat="iStore in ItxWorldWidePage.getStoresByContinent('3') | orderBy : ['countryName']" ng-click="ItxWorldWidePage.selectRegion(iStore)">{{iStore.countryName}}
                                    <div class="langPanel hide">
                                        <div ng-class="iStore.isOpenForSale ? 'langPanelTitle' : 'langPanelTitleNotOnline'">{{iStore.countryName}}</div>                                    <ul class="langList">
                                        <ul class="langList">
                                            <li id="{{iStore.countryName}}_{{iLanguage.name}}" data-ng-repeat="iLanguage in iStore.supportedLanguages"><a ng-href="{{ItxWorldWidePage.getStoreUrl(iStore,iLanguage.id)}}" ng-click="ItxWorldWidePage.selectLang(iLanguage, $event)">{{iLanguage.name}}</a></li>
                                        </ul>
                                    </div>
                                    <img ng-if="iStore.isNew" src="/static/itxwebstandard/images/ico-new.png?t=20160727175509db" alt="">
    								<div class="hide" ng-if="$last" end-world-wide-loading/>
                                </li>
                            </ul>
                        </article>
                    </div>
                </section>
                
                <!-- TODOMAQ RESPONSIVE -->
                <section class="countriesListsSelect row visible-xs">
                    <form class="col-xs-12">
                        <div class="form-field-validation clearfix">
                            <label for="selecciona-pais" class="sr-only">Select your Country</label>
                            <div class="input-container">
                                <div class="wrapSelect">
                                    <select id="selecciona-pais" ng-model="preselectedStore" 
                                        ng-options="template as template.countryName for template in ItxWorldWidePage.stores" 
                                        ng-change="ItxWorldWidePage.selectRegion(preselectedStore)"
                                        name="store" required>
                                        
                                    </select><span class="mark"></span>
                                </div>
                            </div>
                            <span class="message"></span>
                        </div>
                        <div class="form-field-validation clearfix">
                            <label for="selecciona-idioma" class="sr-only">Select your Language</label>
                            <div class="input-container">
                                <div class="wrapSelect">
                                    <select id="selecciona-idioma" ng-model="selectedLang" ng-options="template.id as template.name for template in preselectedStore.supportedLanguages" ng-change="ItxWorldWidePage.selectLangMobile(selectedLang)" name="language" required>
                                    </select><span class="mark"></span>
                                </div>
                            </div>
                            <span class="message"></span>
                        </div>
                        <a class="generic-button" ng-click="ItxWorldWidePage.goToStoreUrl(preselectedStore, selectedLang)">{{ ItxWorldWidePage.getMessage("button") }}</a>
                    </form>
                </section>
                <!-- FIN TODO RESPONSIVE -->

                <footer>
                    <span class="legend basket hidden-xs">Online store</span>
                </footer>


            </main>
<!-- BEGIN SPOT=ZH3_ESpot_WW_Cookies -->
<div class="cookiebox" id="cookiesWarn" style="display: none">
       <a class="ico_close" onclick="inditex.closeCookiesWarn()"><span class="sr-only">Cerrar</span></a>
    <p>Utilizamos cookies propias y de terceros para mejorar su experiencia y nuestros servicios, analizando la navegación en nuestro sitio Web.</p>
    <p>Si continúas navegando, consideramos que aceptas su uso. Puedes obtener más información o conocer cómo cambiar la configuración <a href="#" class="underline open-lbox-cookies">aquí</a>.</p> 
</div>
<!-- END SPOT=ZH3_ESpot_WW_Cookies -->
            
<!-- BEGIN SPOT=ZH3_ESpot_BodyEnd -->

<!-- END SPOT=ZH3_ESpot_BodyEnd -->

	<iframe src="https://www.zarahome.com/i-frame-helper.html?t=20160727175509db" style="position:absolute;width:1px;height:1px;left:-9999px;" onload="inditex.initialize(this, true)"></iframe>
	</body>
</html>

<!-- BEGIN Monitor -->
<!--TagPageName="ItxWorldWidePage"-->
<!--itxStoreId="ZaraHomeES"-->
<!--itxStoreLang="es"-->
<!--itxStoreType="VENTA"-->
<!-- END Monitor -->
